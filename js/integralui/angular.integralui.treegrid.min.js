/*
  filename: angular.integralui.treegrid.min.js
  version : 2.1.010
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUITreeGridService",["$rootScope",function(c){var h=null;return{addColumn:function(e,k){c.$broadcast(e+"-add-column",k)},clearColumns:function(e){c.$broadcast(e+"-clear-columns")},insertColumnAt:function(e,k,f){c.$broadcast(e+"-insert-column-at",k,f)},insertColumnBefore:function(e,k,f){c.$broadcast(e+"-insert-column-before",k,f)},insertColumnAfter:function(e,k,f){c.$broadcast(e+"-insert-column-after",k,f)},removeColumn:function(e,k){c.$broadcast(e+"-remove-column",k)},removeColumnAt:function(e,k){c.$broadcast(e+"-remove-column-at",k)},addRow:function(e,k,f){c.$broadcast(e+"-add-row",k,f)},clearRows:function(e,k){c.$broadcast(e+"-clear-rows",k)},insertRowAt:function(e,k,f,h){c.$broadcast(e+"-insert-row-at",k,f,h)},insertRowBefore:function(e,k,f){c.$broadcast(e+"-insert-row-before",k,f)},insertRowAfter:function(e,k,f){c.$broadcast(e+"-insert-row-after",k,f)},removeRow:function(e,k){c.$broadcast(e+"-remove-row",k)},removeRowAt:function(e,k,f){c.$broadcast(e+"-remove-row-at",k,f)},exportToJSON:function(e,k,f,h,v){c.$broadcast(e+"-export-json",k,f,h,v);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,k,f,h,v){c.$broadcast(e+"-load-data",k,f,h,v)},beginLoad:function(e,k){c.$broadcast(e+"-begin-load",k)},collapse:function(e,k){c.$broadcast(e+"-collapse",k)},endLoad:function(e){c.$broadcast(e+"-end-load")},expand:function(e,k){c.$broadcast(e+"-expand",k)},expandColIndex:function(e,k){c.$broadcast(e+"-expand-col-index",k)},toggle:function(e,k){c.$broadcast(e+"-toggle",k)},filter:function(e,k,f){c.$broadcast(e+"-filter",k,f)},findRowById:function(e,k){c.$broadcast(e+"-find-row-by-id",k);var f=this.getTempData();this.clearTempData();return f?f:null},findRowByPath:function(e,k,f){c.$broadcast(e+"-find-row-by-path",k,f);e=this.getTempData();this.clearTempData();return e?e:null},findRowByText:function(e,k){c.$broadcast(e+"-find-row-by-text",k);var f=this.getTempData();this.clearTempData();return f?f:null},getRowParent:function(e,k){c.$broadcast(e+"-get-row-parent",k);var f=this.getTempData();this.clearTempData();return f?f:null},focus:function(e,k){c.$broadcast(e+"-focus",k)},clearTempData:function(){h=null},ensureVisible:function(e,k){c.$broadcast(e+"-ensure-visible",k)},getTempData:function(){return h},getRowLevel:function(e,k){c.$broadcast(e+"-get-row-level",k);var f=this.getTempData();this.clearTempData();return f?f:0},getFlatList:function(e,k){c.$broadcast(e+"-get-flat-list",k);var f=this.getTempData();this.clearTempData();return f?f:[]},getFullPath:function(e,k){c.$broadcast(e+"-get-full-path",k);var f=this.getTempData();this.clearTempData();return f?f:""},getList:function(e,k){c.$broadcast(e+"-get-list",k);var f=this.getTempData();this.clearTempData();return f?f:[]},setTempData:function(c){h=c},selectedColumn:function(e,k){if(k)c.$broadcast(e+"-set-selected-column",k);else{c.$broadcast(e+"-get-selected-column");var f=this.getTempData();this.clearTempData();return f?f:null}},selectedRow:function(e,k){if(k)c.$broadcast(e+"-set-selected-row",k);else{c.$broadcast(e+"-get-selected-row");var f=this.getTempData();this.clearTempData();return f?f:null}},selectedRows:function(e){c.$broadcast(e+"-get-selected-rows");e=this.getTempData();this.clearTempData();return e?e:null},getScrollPos:function(e){c.$broadcast(e+"-get-scroll-pos");e=this.getTempData();this.clearTempData();return e?e:{x:0,y:0}},setScrollPos:function(e,k){c.$broadcast(e+"-set-scroll-pos",k)},scrollTo:function(e,k,f){c.$broadcast(e+"-scroll-to",k,f)},sort:function(e,k,f,h){c.$broadcast(e+"-sort",k,f,h)},refresh:function(e,k,f){c.$broadcast(e+"-refresh",k,f)},resumeLayout:function(e){c.$broadcast(e+"-resume-layout")},suspendLayout:function(e){c.$broadcast(e+"-suspend-layout")},updateLayout:function(e){c.$broadcast(e+"-update-layout")},updateView:function(e){c.$broadcast(e+"-update-view")}}}]).controller("IntegralUITreeGridController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUITreeGridService","IntegralUIDragDrop","IntegralUIFilter",function(c,h,e,k,f,C,v,l,p){var b=this;this.suppressProcess=!1;this.hoverCell=this.hoverRow=this.hoverColumn=null;b.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};b.defaultStyle={general:"iui-treegrid",column:{general:{content:"iui-treegrid-column-cell-content",disabled:"iui-treegrid-column-disabled",normal:"iui-treegrid-column",hovered:"iui-treegrid-column-hovered",selected:"iui-treegrid-column-selected"},header:{content:"iui-treegrid-column-header-cell-content",disabled:"iui-treegrid-column-header-disabled",normal:"iui-treegrid-column-header",hovered:"iui-treegrid-column-header-hovered",selected:"iui-treegrid-column-header-selected"},body:{content:"iui-treegrid-column-body-cell-content",disabled:"iui-treegrid-column-body-disabled",normal:"iui-treegrid-column-body",hovered:"iui-treegrid-column-body-hovered",selected:"iui-treegrid-column-body-selected"},footer:{content:"iui-treegrid-column-footer-cell-content",disabled:"iui-treegrid-column-footer-disabled",normal:"iui-treegrid-column-footer",hovered:"iui-treegrid-column-footer-hovered",selected:"iui-treegrid-column-footer-selected"}},row:{general:{disabled:"iui-treegrid-row-disabled",focused:"iui-treegrid-row-focused",normal:"iui-treegrid-row",hovered:"iui-treegrid-row-hovered",selected:"iui-treegrid-row-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},expandBox:{general:"iui-treegrid-expand-box",animated:"iui-treegrid-expand-box-load",expanded:"iui-treegrid-expand-box-open",collapsed:"iui-treegrid-expand-box-close"},cell:{content:"iui-treegrid-row-cell-content",general:"iui-treegrid-row-cell",disabled:"iui-treegrid-row-cell-disabled",focused:"iui-treegrid-row-cell-focused",normal:"iui-treegrid-row-cell",hovered:"iui-treegrid-row-cell-hovered",selected:"iui-treegrid-row-cell-selected"}},cell:{content:"iui-treegrid-row-cell-content",general:"iui-treegrid-row-cell",disabled:"iui-treegrid-row-cell-disabled",focused:"iui-treegrid-row-cell-focused",normal:"iui-treegrid-row-cell",hovered:"iui-treegrid-row-cell-hovered",selected:"iui-treegrid-row-cell-selected"}};b.options={allowAnimation:!0,allowCellFocus:!0,allowColumnReorder:!1,allowDrag:!1,allowDrop:!0,allowFilter:!1,allowFocus:!0,animationSpeed:200,autoExpand:!0,cellFields:{allowEdit:"allowEdit",cid:"cid",content:"content",contextMenu:"contextMenu",enabled:"enabled",labelEdit:"labelEdit",style:"style",text:"text",value:"value"},columnFields:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowFilter:"allowFilter",comparer:"comparer",contentAlignment:"contentAlignment",contextMenu:"contextMenu",editorType:"editorType",editorSettings:"editorSettings",filterParams:"filterParams",filterTemplate:"filterTemplate",fixedWidth:"fixedWidth",footerAlignment:"footerAlignment",footerText:"footerText",headerAlignment:"headerAlignment",headerContent:"headerContent",headerTemplate:"headerTemplate",headerText:"headerText",dataSource:null,icon:"icon",id:"id",style:"style",visible:"visible",width:"width"},controlStyle:b.defaultStyle,editorSettings:{activate:"click"},expandColIndex:0,fillSpace:!1,gridLines:"both",hoverSelection:!1,indent:15,labelEdit:!1,loadRow:null,pathSeparator:"\\",rowFields:{allowDrag:"allowDrag",allowDrop:"allowDrop",cells:"cells",content:"content",contextMenu:"contextMenu",dataSource:null,enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",pid:"pid",rows:"rows",statusIcon:"statusIcon",style:"style",text:"text"},rtl:!1,selectedColumn:null,selectedIndex:-1,selectedRow:null,selectedRows:[],selectionMode:"one",showFooter:!0,showHeader:!0,showIcons:!0,sorting:"none"};c.$on(c.name+"-add-column",function(d,a){b.columnsObj.insertAt(a,-1,null,b.columnIsAdded)});c.$on(c.name+"-clear-columns",function(d){b.columnsObj.clear(null,b.columnIsRemoved)});c.$on(c.name+"-insert-column-at",function(d,a,c){b.columnsObj.insertAt(a,c,null,b.columnIsAdded)});c.$on(c.name+"-insert-column-after",function(d,a,c){b.columnsObj.insertByRef(a,c,!0,b.columnIsAdded)});c.$on(c.name+"-insert-column-before",function(d,a,c){b.columnsObj.insertByRef(a,c,!1,b.columnIsAdded)});c.$on(c.name+"-remove-column",function(d,a){b.columnsObj.removeAt(a,-1,null,b.columnIsRemoved)});c.$on(c.name+"-remove-column-at",function(d,a){b.columnsObj.removeAt(null,a,null,b.columnIsRemoved)});b.columnIsAdded=function(){b.updateLayout()};b.columnIsRemoved=function(d,a){b.updateLayout()};c.$on(c.name+"-add-row",function(d,a,c){b.rowsObj.insertAt(a,-1,c,b.rowIsAdded)});c.$on(c.name+"-clear-rows",function(d,a){b.rowsObj.clear(a,b.rowIsRemoved);a||b.setScrollPos({x:0,y:0})});c.$on(c.name+"-insert-row-at",function(d,a,c,g){b.rowsObj.insertAt(a,c,g,b.rowIsAdded)});c.$on(c.name+"-insert-row-after",function(d,a,c){b.rowsObj.insertByRef(a,c,!0,b.rowIsAdded)});c.$on(c.name+"-insert-row-before",function(d,a,c){b.rowsObj.insertByRef(a,c,!1,b.rowIsAdded)});c.$on(c.name+"-remove-row",function(d,a){b.rowsObj.removeAt(a,-1,null,b.rowIsRemoved)});c.$on(c.name+"-remove-row-at",function(d,a,c){b.rowsObj.removeAt(null,a,c,b.rowIsRemoved)});this.rowIsAdded=function(){b.updateCurrentLayout()};this.rowIsRemoved=function(d,a,c){b.updateCurrentLayout()};this.objIsRemoved=function(d,a,c){b.updateCurrentLayout()};b.columnList=[];b.columnFilterList=[];this.updateColumnList=function(){b.columnList.length=0;b.columnFilterList.length=0;var d=b.columnsObj.getList();if(d)for(var a=0;a<d.length;a++){var c=d[a];c.type="column";c[b.options.columnFields.id]||(c[b.options.columnFields.id]=f.getUniqueId());if(0!=c[b.options.columnFields.visible]){var g=c[b.options.columnFields.filterParams],g=g?p.createTree(g.conditions,g.formula):null;b.columnFilterList.push({cid:c[b.options.columnFields.id],tree:g});b.columnList.push(c)}}};var a=function(d){for(var a=null,c=0;c<b.columnFilterList.length;c++)if(b.columnFilterList[c].cid==d){a=b.columnFilterList[c].tree;break}return a},xa=function(d,oa){if(0==b.options.allowFilter)return!0;var c=!0;if(d){for(var g=-1,m=null,f=null,e=0;e<d[b.options.rowFields.cells].length&&(c=!0,f=d[b.options.rowFields.cells][e],g=f[b.options.cellFields.cid],m=b.getColumnById(g),!m&&e<b.columnList.length&&(m=b.columnList[e]),m&&m[b.options.columnFields.filterParams]&&(c=m[b.options.columnFields.filterParams],f=f[b.options.cellFields.value]?f[b.options.cellFields.value]:f[b.options.cellFields.text],c=c.callback?c.callback(f):p.match(f,c.conditions,c.formula,a(g))),c);e++);if(c&&(oa||b.isRowExpanded(d))&&(g=d[b.options.rowFields.rows])&&0<g.length){for(f=e=0;f<g.length;f++)(childPass=xa(g[f],oa))&&e++;0==e&&(c=!1)}}return c},y=b.options.indent;b.currentList=[];b.indentList=[];b.longestRow=null;b.isThereChildRows=!1;this.isThereVisibleChildren=function(d){var a=!1;if(d&&(d=d[b.options.rowFields.rows])&&0<d.length)for(var c=0;c<d.length;c++)if(xa(d[c])){a=!0;break}return a};var P=function(d,a,c,g){d.type="row";d[b.options.rowFields.id]||(d[b.options.rowFields.id]=f.getUniqueId());c&&(d[b.options.rowFields.pid]=c);c=!0;var m=d[b.options.rowFields.cells];if(m&&0<m.length){c=xa(d,g);b.isRowExpanded(d)&&d[b.options.rowFields.rows]&&0<d[b.options.rowFields.rows].length&&(c=c&&b.isThereVisibleChildren(d));for(var e=-1,k="label",h=null,h=null,l=0;l<b.columnList.length;l++){var h=b.columnList[l],e=h[b.options.columnFields.id],k=h[b.options.columnFields.editorType],h=h[b.options.columnFields.editorSettings],p=l;e&&(p=b.getCellIndexById(m,l,e));0<=p&&p<m.length&&(m[p].type="cell",b.setDefaultCellValue(m[p],k,h))}}c&&(g?b.fullList.push(d):(b.currentList.push(d),b.indentList.push(a)));return c},D=function(d,a,c,g){var m=!0;if(!d[b.options.rowFields.rows])return m=P(d,a,c,g);if(m=P(d,a,c,g)){c=0;var f=!0;if(g||b.isRowExpanded(d)){var e=d[b.options.rowFields.rows];if(e){b.applySorting(e);for(var h=0;h<e.length;h++)(f=D(e[h],a+y,d[b.options.rowFields.id],g))&&c++}}g||b.isThereChildRows||!(0<c||!b.isRowExpanded(d)&&d[b.options.rowFields.rows]&&0<d[b.options.rowFields.rows].length&&b.isThereVisibleChildren(d))||(b.isThereChildRows=!0)}return m};b.fullList=[];this.getFullList=function(){b.fullList.length=0;for(var d=b.rowsObj.getList(),a=0;a<d.length;a++)D(d[a],0,null,!0);return b.fullList};this.getCurrentList=function(){return b.currentList};this.updateCurrentList=function(){b.currentList.length=0;b.indentList.length=0;b.isThereChildRows=!1;var d=b.rowsObj.getList();if(d){b.applySorting(d);for(var a=0;a<d.length;a++)D(d[a],0,null,!1)}};this.columnEvents={clear:function(d){return angular.isDefined(c.events)&&c.events.clearColumns?c.events.clearColumns({parent:d.e.parent}):c.clearColumns(d)},objAdded:function(d){return angular.isDefined(c.events)&&c.events.columnAdded?c.events.columnAdded({column:d.e.column}):c.columnAdded(d)},objAdding:function(d){return angular.isDefined(c.events)&&c.events.rowAdding?c.events.columnAdding({column:d.e.column}):c.columnAdding(d)},objRemoved:function(d){return angular.isDefined(c.events)&&c.events.rowRemoved?c.events.columnRemoved({column:d.e.column}):c.columnRemoved(d)},objRemoving:function(d){return angular.isDefined(c.events)&&c.events.rowRemoving?c.events.columnRemoving({column:d.e.column}):c.columnRemoving(d)}};this.rowEvents={clear:function(d){return angular.isDefined(c.events)&&c.events.clearRows?c.events.clearRows({parent:d.e.parent}):c.clearRows(d)},objAdded:function(d){return angular.isDefined(c.events)&&c.events.rowAdded?c.events.rowAdded({row:d.e.row}):c.rowAdded(d)},objAdding:function(d){return angular.isDefined(c.events)&&c.events.rowAdding?c.events.rowAdding({row:d.e.row}):c.rowAdding(d)},objRemoved:function(d){return angular.isDefined(c.events)&&c.events.rowRemoved?c.events.rowRemoved({row:d.e.row}):c.rowRemoved(d)},objRemoving:function(d){return angular.isDefined(c.events)&&c.events.rowRemoving?c.events.rowRemoving({row:d.e.row}):c.rowRemoving(d)}};this.getRowFields=function(d){return{content:d.content?d.content:"content",icon:d.icon?d.icon:"icon",id:d.id?d.id:"id",pid:d.pid?d.pid:"pid",objects:d.rows?d.rows:"rows",subobjects:d.cells?d.cells:"cells",text:d.text?d.text:"text"}};b.columnsObj=new C({objects:c.columns,events:b.columnEvents,fields:b.options.columnFields});b.rowsObj=new C({objects:c.rows,events:b.rowEvents,fields:b.getRowFields(b.options.rowFields)});c.$on(c.name+"-load-data",function(d,a,c,g,m){b.loadData(a,c,g,m)});c.$on(c.name+"-export-json",function(d,a,c,g,m){v.setTempData(b.exportToJSON(a,c,g,m))});this.exportToJSON=function(d,a,c,g){var m=g,m=m?m:null,f=b.columnsObj.getList();d=JSON.stringify(f,d?d:[b.options.columnFields.allowDrag,b.options.columnFields.allowDrop,b.options.columnFields.allowFilter,b.options.columnFields.contentAlignment,b.options.columnFields.contextMenu,b.options.columnFields.editorType,b.options.columnFields.editorSettings,b.options.columnFields.filterParams,b.options.columnFields.filterTemplate,b.options.columnFields.fixedWidth,b.options.columnFields.footerAlignment,b.options.columnFields.footerText,b.options.columnFields.headerAlignment,b.options.columnFields.headerContent,b.options.columnFields.headerTemplate,b.options.columnFields.headerText,b.options.columnFields.icon,b.options.columnFields.id,b.options.columnFields.style,b.options.columnFields.visible,b.options.columnFields.width],m);g=g?g:null;m=!1!==c?b.getFullList():b.rowsObj.getList();a=a?a:[b.options.rowFields.allowCellFocus,b.options.rowFields.allowDrag,b.options.rowFields.allowDrop,b.options.rowFields.allowFocus,b.options.rowFields.cells,b.options.rowFields.content,b.options.rowFields.contextMenu,b.options.rowFields.enabled,b.options.rowFields.expanded,b.options.rowFields.hasChildren,b.options.rowFields.icon,b.options.rowFields.id,b.options.rowFields.pid,b.options.rowFields.statusIcon,b.options.rowFields.style,b.options.rowFields.text];0==c&&a.push(b.options.rowFields.rows);c=JSON.stringify(m,a,g);return'[\n{ "columns": '+d+' },\n{ "rows": '+c+" }\n]"};this.loadData=function(d,a,q,g){b.updateDataFields(q);var m=[],f=b.options.rowFields;b.rowsObj.clear(a);if(d)if(!1!==g){var e=[];d.forEach(function(d,a){var b=d[f.pid];e[b]?(e[b][f.rows]||(e[b][f.rows]=[]),e[d[f.id]]=d,e[b][f.rows].push(d)):(e[d[f.id]]=d,m.push(d))});e.length=0}else m=d;if(a)for(a[b.options.rowFields.rows]=m,d=0;d<a[b.options.rowFields.rows].length;d++)a[b.options.rowFields.rows][d][b.options.rowFields.pid]=a[b.options.rowFields.id];else angular.isDefined(c.rows)&&(c.rows=m);b.rowsObj=new C({objects:c.rows,events:b.rowEvents,fields:b.getRowFields(b.options.rowFields)});b.updateLayout()};this.updateDataFields=function(d){d&&(d.column&&(b.options.columnFields={allowDrag:d.column.allowDrag?d.column.allowDrag:"allowDrag",allowDrop:d.column.allowDrop?d.column.allowDrop:"allowDrop",allowFilter:d.column.allowFilter?d.column.allowFilter:"allowFilter",comparer:d.column.comparer?d.column.comparer:"comparer",contentAlignment:d.column.contentAlignment?d.column.contentAlignment:"contentAlignment",contextMenu:d.column.contextMenu?d.column.contextMenu:"contextMenu",dataSource:d.column.dataSource,editorType:d.column.editorType?d.column.editorType:"editorType",editorSettings:d.column.editorSettings?d.column.editorSettings:"editorSettings",filterParams:d.column.filterParams?d.column.filterParams:"filterParams",filterTemplate:d.column.filterTemplate?d.column.filterTemplate:"filterTemplate",fixedWidth:d.column.fixedWidth?d.column.fixedWidth:"fixedWidth",footerAlignment:d.column.footerAlignment?d.column.footerAlignment:"footerAlignment",footerContent:d.column.footerContent?d.column.footerContent:"footerContent",footerText:d.column.footerText?d.column.footerText:"footerText",headerAlignment:d.column.headerAlignment?d.column.headerAlignment:"headerAlignment",headerContent:d.column.headerContent?d.column.headerContent:"headerContent",headerTemplate:d.column.headerTemplate?d.column.headerTemplate:"headerTemplate",headerText:d.column.headerText?d.column.headerText:"headerText",icon:d.column.icon?d.column.icon:"icon",id:d.column.id?d.column.id:"id",style:d.column.style?d.column.style:"style",visible:d.column.visible?d.column.visible:"visible",width:d.column.width?d.column.width:"width"},b.columnsObj&&b.columnsObj.updateDataFields(b.options.columnFields)),d.row&&(b.options.rowFields={allowDrag:d.row.allowDrag?d.row.allowDrag:"allowDrag",allowDrop:d.row.allowDrop?d.row.allowDrop:"allowDrop",allowFocus:d.row.allowFocus?d.row.allowFocus:"allowFocus",cells:d.row.cells?d.row.cells:"cells",content:d.row.content?d.row.content:"content",contextMenu:d.row.contextMenu?d.row.contextMenu:"contextMenu",dataSource:d.row.dataSource,enabled:d.row.enabled?d.row.enabled:"enabled",expanded:d.row.expanded?d.row.expanded:"expanded",hasChildren:d.row.hasChildren?d.row.hasChildren:"hasChildren",icon:d.row.icon?d.row.icon:"icon",id:d.row.id?d.row.id:"id",rows:d.row.rows?d.row.rows:"rows",pid:d.row.pid?d.row.pid:"pid",statusIcon:d.row.statusIcon?d.row.statusIcon:"statusIcon",style:d.row.style?d.row.style:"style",text:d.row.text?d.row.text:"text"},b.rowsObj&&b.rowsObj.updateDataFields(b.options.rowFields)),d.cell&&(b.options.cellFields={allowEdit:d.cell.allowEdit?d.cell.allowEdit:"allowEdit",cid:d.cell.cid?d.cell.cid:"cid",content:d.cell.content?d.cell.content:"content",contextMenu:d.cell.contextMenu?d.cell.contextMenu:"contextMenu",enabled:d.cell.enabled?d.cell.enabled:"enabled",labelEdit:d.cell.labelEdit?d.cell.labelEdit:"labelEdit",style:d.cell.style?d.cell.style:"style",text:d.cell.text?d.cell.text:"text",value:d.cell.value?d.cell.value:"value"}))};this.updateData=function(){b.options.rowFields.dataSource&&(b.loadData(b.options.rowFields.dataSource),b.rowsObj=new C({objects:c.rows,events:b.rowEvents,fields:b.getRowFields(b.options.rowFields)}))};var G=!1;this.dragDropStatus=function(d){if(d)G=d;else return G};this.getDnDSource=function(d){return{text:d.dataTransfer?d.dataTransfer.getData("text"):d.originalEvent.dataTransfer?d.originalEvent.dataTransfer.getData("text"):""}};var ra=angular.element('<div class="iui-drop-marker" data-element="dropmark"></div>');this.getDropMarkLine=function(){return dropMarkLine};angular.element(k).bind("dragenter",function(d){b.dropMark()});angular.element(k).bind("dragend",function(d){b.removeDropMark();b.dragIcon&&angular.element(b.dragIcon).remove();b.cancelScrollTimer()});b.getMousePos=function(d){return{x:d.pageX?d.pageX:d.originalEvent?d.originalEvent.pageX:0,y:d.pageY?d.pageY:d.originalEvent?d.originalEvent.pageY:0}};this.getTreeName=function(){return angular.isDefined(c.name)?c.name:""};h.bind("dragenter",function(d){d.preventDefault();var a=l.getData();a.source||(a.source=b.getDnDSource(d));d={sourceTree:a.sourceCtrl?a.sourceCtrl.getTreeName():"",dragRow:a.source,targetTree:b.getTreeName(),targetRow:a.target,mousePos:b.getMousePos(d)};b.callDragEnter(d)});h.bind("dragover",function(d){d.preventDefault();if(b.isDropInRange(d)){var a=!0;d.dataTransfer?a="none"===d.dataTransfer.effectAllowed?!1:!0:d.originalEvent&&d.originalEvent.dataTransfer&&(a="none"===d.originalEvent.dataTransfer.effectAllowed?!1:!0);if(a){d.dataTransfer?d.dataTransfer.dropEffect=b.options.allowDrop?"move":"none":d.originalEvent&&d.originalEvent.dataTransfer&&(d.originalEvent.dataTransfer.dropEffect=b.options.allowDrop?"move":"none");a=l.getData();a.source||(a.source=b.getDnDSource(d));l.setData({source:a.source,sourceCtrl:a.sourceCtrl,target:null,dropPos:-1});a={sourceTree:a.sourceCtrl?a.sourceCtrl.getTreeName():"",dragRow:a.source,targetTree:b.getTreeName(),targetRow:null,isDropAllowed:b.options.allowDrop,dropPos:-1,mousePos:b.getMousePos(d)};b.callDragOver(a);a=b.getMousePos(d);d=a.y+16;var a=a.x+20,q=b.getDropMarkWindow();q.empty();q.append("<span class='iui-drop-marker-move-end'></span><span class='iui-drop-marker-title'>"+(c.name?c.name:"TreeGrid")+"</span>");b.updateDropMarkElem(b.getDropMarkWindow(),{top:d,left:a});b.dropMark(!0)}}else b.dropMark(),d.dataTransfer?d.dataTransfer.dropEffect="none":d.originalEvent&&d.originalEvent.dataTransfer&&(d.originalEvent.dataTransfer.dropEffect="none")});h.bind("drop",function(d){d.preventDefault();b.dropMark();if(b.isDropInRange(d)){var a=!0;d.dataTransfer?a="none"===d.dataTransfer.effectAllowed?!1:!0:d.originalEvent&&d.originalEvent.dataTransfer&&(a="none"===d.originalEvent.dataTransfer.effectAllowed?!1:!0);if(a&&(a=l.getData(),a.source||(a.source=b.getDnDSource(d)),a.source)){var q={sourceTree:a.sourceCtrl?a.sourceCtrl.getTreeName():"",dragRow:a.source,targetTree:b.getTreeName(),targetRow:null,isDropAllowed:b.options.allowDrop,dropPos:-1,mousePos:b.getMousePos(d)};!1!==b.callDragDrop(q)&&(b.drop(a),c.$$phase||c.$apply())}}l.clearData();d.stopPropagation()});h.bind("dragleave",function(d){d.preventDefault();b.dropMark();var a=l.getData();a.source||(a.source=b.getDnDSource(d));d={sourceTree:a.sourceCtrl?a.sourceCtrl.getTreeName():"",dragRow:a.source,targetTree:b.getTreeName(),targetRow:a.target,mousePos:b.getMousePos(d)};b.callDragLeave(d);b.cancelScrollTimer()});h.bind("dragend",function(d){d.preventDefault();b.dropMark();l.getData().source||l.clearData()});h.bind("mouseleave",function(d){d.preventDefault();b.dropMark();b.hoverColumn=null;b.hoverRow=null;b.hoverCell=null});this.containsMousePos=function(d,a){return l.hitTest(d,a,{left:0,top:0,right:h[0].clientWidth,bottom:h[0].clientHeight})};this.isPopupActive=function(){return!1};var T=function(d,a){var c=b.options.rowFields;if(!d[c.cells]){d[c.cells]=[];var g={};g[b.options.cellFields.text]=d[a.text];d[c.cells].push(g)}d[c.rows]||(d[c.rows]=[]);d[c.rows].length=0;if(d[a.items]&&0<d[a.items].length)for(g=0;g<d[a.items].length;g++)d[c.rows].push(T(d[a.items][g],a));return d},Q=function(d,a){var c=!1;a.sourceCtrl&&(c=a.sourceCollection.removeAt(d,-1,null,a.sourceCtrl.objIsRemoved));c&&("item"==d.type&&(d=T(d,a.sourceCtrl.options.dataFields)),0===a.dropPos?b.rowsObj.insertAt(d,-1,a.target,b.rowIsAdded):1===a.dropPos||2===a.dropPos?1===a.dropPos?b.rowsObj.insertByRef(d,a.target,!1,b.rowIsAdded):b.rowsObj.insertByRef(d,a.target,!0,b.rowIsAdded):b.rowsObj.insertAt(d,-1,null,b.rowIsAdded))};this.setDropSelection=function(d,a){var c=d;!c&&0<=a&&a<b.currentList.length&&(c=b.currentList[a]);b.clearPrevSelection(c);b.rowSelection(c)};this.drop=function(d){if(d&&d.sourceCtrl){d.sourceCtrl.suppressProcess=!0;b.allowUpdate=!1;d.sourceCtrl.allowUpdate=!1;var a=d.source,c=-1;if(Array.isArray(d.source)){0<d.source.length&&(c=d.sourceCtrl.getObjCurrentIndex(d.source[d.source.length-1]));for(var g=[],m=0;m<d.source.length;m++){for(var f=!1,h=d.sourceCollection.getParent(d.source[m]);h;){if(d.sourceCtrl.isObjInSelList(h)){f=!0;break}h=d.sourceCollection.getParent(h)}f||g.push(d.source[m])}if(0<g.length)if(a=g[g.length-1],m=d.sourceCtrl.getObjCurrentIndex(g[0]),f=d.sourceCtrl.getObjCurrentIndex(a),m<=f)for(m=0;m<g.length;m++)Q(g[m],d);else for(m=g.length-1;0<=m;m--)Q(g[m],d)}else c=d.sourceCtrl.getObjCurrentIndex(d.source),Q(d.source,d);d.sourceCtrl!==b?(b.allowUpdate=!0,d.sourceCtrl.allowUpdate=!0,b.updateCurrentLayout(),d.sourceCtrl.updateCurrentLayout()):(b.allowUpdate=!0,b.updateCurrentLayout());d.sourceCtrl.multiSelection(!1);var k=e(function(){d.sourceCtrl!==b&&d.sourceCtrl.setDropSelection(null,c);b.setDropSelection(a);b.updateFocus(b.getObjCurrentIndex(a),0);e.cancel(k)},1);d.sourceCtrl.suppressProcess=!1}};this.isDragAllowed=function(d){return b.options.allowDrag?d&&(d[b.options.rowFields.allowDrag]||void 0===d[b.options.rowFields.allowDrag])?!0:!1:!1};this.isChildOf=function(d,a){var c=!1;if(d&&a){var g=a[b.options.rowFields.rows];if(g&&0<g.length)for(var m=0;m<g.length;m++){if(f.isEqual(d[b.options.rowFields.id],g[m][b.options.rowFields.id])){c=!0;break}else c=b.isChildOf(d,g[m]);if(c)break}}return c};this.isParentOf=function(d,a){var c=b.rowsObj.getParent(a);return d&&a&&c&&f.isEqual(d[b.options.rowFields.id],c[b.options.rowFields.id])?!0:!1};this.isDropAllowed=function(d,a,c){var g=b.options.allowDrop;if(g&&d&&a&&(g=a[b.options.rowFields.allowDrop]||void 0===a[b.options.rowFields.allowDrop]?!0:!1))if(Array.isArray(d))for(var m=0;m<d.length;m++){if(f.isEqual(d[m][b.options.rowFields.id],a[b.options.rowFields.id])||0===c&&b.isParentOf(a,d[m])||b.isChildOf(a,d[m])){g=!1;break}if(!g)break}else if(f.isEqual(d[b.options.rowFields.id],a[b.options.rowFields.id])||0===c&&b.isParentOf(a,d)||b.isChildOf(a,d))g=!1;return g};this.getDropMarkWindow=function(){for(var d=ra,a=angular.element(document.body).children(),b=0;b<a.length;b++){var c=angular.element(a[b]);if(c[0].attributes&&c[0].attributes["data-element"]&&"dropmark"===c[0].attributes["data-element"].value){d=c;break}}return d};this.dropMark=function(d,a){a||(a=b.getDropMarkWindow());if(a){var c="none";this.options.allowDrop&&(c=d?"block":"none");angular.element(a).css("display",c)}};this.updateDropMarkElem=function(d,a){d&&a&&(d.css("top",a.top+"px"),d.css("left",a.left+"px"),d.css("width",a.width+"px"))};this.updateEditorSettings=function(d){b.options.editorSettings=d?{activate:f.isFieldAvailable(d.activate,"click")}:{activate:"click"}};this.allowEvents=!0;this.callAfterCollapse=function(d){angular.isDefined(c.events)&&c.events.afterCollapse&&c.events.afterCollapse({row:d});c.afterCollapse({e:{row:d}})};this.callAfterExpand=function(d){angular.isDefined(c.events)&&c.events.afterExpand&&c.events.afterExpand({row:d});c.afterExpand({e:{row:d}})};this.callAfterEdit=function(d){angular.isDefined(c.events)&&c.events.afterLabelEdit&&c.events.afterLabelEdit({cell:d});c.afterLabelEdit({e:{cell:d}})};this.callAfterSelect=function(d){angular.isDefined(c.events)&&c.events.afterSelect?c.events.afterSelect({object:d}):c.afterSelect({e:{object:d}});angular.isDefined(c.events)&&c.events.selectionChanged?c.events.selectionChanged({object:d}):c.selectionChanged({e:{object:d}})};this.callBeforeCollapse=function(d){var a=!0;return a=angular.isDefined(c.events)&&c.events.beforeCollapse?c.events.beforeCollapse({row:d}):c.beforeCollapse({e:{row:d}})};this.callBeforeExpand=function(d){var a=!0;return a=angular.isDefined(c.events)&&c.events.beforeExpand?c.events.beforeExpand({row:d}):c.beforeExpand({e:{row:d}})};this.callBeforeEdit=function(d){var a=!0;return a=angular.isDefined(c.events)&&c.events.beforeLabelEdit?c.events.beforeLabelEdit({cell:d}):c.beforeLabelEdit({e:{cell:d}})};this.callCellValueChanging=function(d,a,q){var g=!0;b.allowEvents&&(g=angular.isDefined(c.events)&&c.events.cellvalueChanging?c.events.cellvalueChanging({row:d,cell:a,value:q}):c.cellvalueChanging({e:{row:d,cell:a,value:q}}));return g};this.callCellValueChanged=function(d,a,q){b.allowEvents&&(angular.isDefined(c.events)&&c.events.cellvalueChanged?c.events.cellvalueChanged({row:d,cell:a,value:q}):c.cellvalueChanged({e:{row:d,cell:a,value:q}}))};this.callColumnClick=function(d,a){angular.isDefined(c.events)&&c.events.columnClick&&c.events.columnClick({column:d,mousePos:a});c.columnClick({e:{column:d,mousePos:a}})};this.callColumnDblClick=function(d,a){angular.isDefined(c.events)&&c.events.columnDblclick&&c.events.columnDblclick({column:d,mousePos:a});c.columnDblclick({e:{column:d,mousePos:a}})};this.callColumnHover=function(d){angular.isDefined(c.events)&&c.events.columnHover&&c.events.columnHover({column:d});c.columnHover({e:{column:d}})};this.callColumnPosChanging=function(d,a){var b=!0;return b=angular.isDefined(c.events)&&c.events.columnPoschanging?c.events.columnPoschanging({sourceColumn:d,targetColumn:a}):c.columnPoschanging({e:{sourceColumn:d,targetColumn:a}})};this.callColumnPosChanged=function(d,a){angular.isDefined(c.events)&&c.events.columnPoschanged&&c.events.columnPoschanged({sourceColumn:d,targetColumn:a});c.columnPoschanged({e:{sourceColumn:d,targetColumn:a}})};this.callColumnRightClick=function(d,a){angular.isDefined(c.events)&&c.events.columnRightclick&&c.events.columnRightclick({column:d,mousePos:a});c.columnRightclick({e:{column:d,mousePos:a}})};this.callColumnSizeChanged=function(d,a){angular.isDefined(c.events)&&c.events.columnSizechanged&&c.events.columnSizechanged({column:d});c.columnSizechanged({e:{column:d}})};this.callDragEnter=function(d){angular.isDefined(c.events)&&c.events.dragEnter?c.events.dragEnter({sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,mousePos:d.mousePos}):c.dragEnter({e:{sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,mousePos:d.mousePos}})};this.callDragOver=function(d){var a=!0;return a=angular.isDefined(c.events)&&c.events.dragOver?c.events.dragOver({sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,isDropAllowed:d.isDropAllowed,dropPos:d.dropPos,mousePos:d.mousePos}):c.dragOver({e:{sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,isDropAllowed:d.isDropAllowed,dropPos:d.dropPos,mousePos:d.mousePos}})};this.callDragDrop=function(d){var a=!0;return a=angular.isDefined(c.events)&&c.events.dragDrop?c.events.dragDrop({sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,isDropAllowed:d.isDropAllowed,dropPos:d.dropPos,mousePos:d.mousePos}):c.dragDrop({e:{sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,isDropAllowed:d.isDropAllowed,dropPos:d.dropPos,mousePos:d.mousePos}})};this.callDragLeave=function(d){angular.isDefined(c.events)&&c.events.dragLeave?c.events.dragLeave({sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,mousePos:d.mousePos}):c.dragLeave({e:{sourceTree:d.sourceTree,dragRow:d.dragRow,targetTree:d.targetTree,targetRow:d.targetRow,mousePos:d.mousePos}})};this.callCellClick=function(d,a,b){angular.isDefined(c.events)&&c.events.cellClick&&c.events.cellClick({row:d,cell:a,mousePos:b});c.cellClick({e:{row:d,cell:a,mousePos:b}})};this.callRowClick=function(d,a){angular.isDefined(c.events)&&c.events.rowClick&&c.events.rowClick({row:d,mousePos:a});c.rowClick({e:{row:d,mousePos:a}})};this.callRowDblClick=function(d,a){var b=!0;return b=angular.isDefined(c.events)&&c.events.rowDblClick?c.events.rowDblClick({row:d,mousePos:a}):c.rowDblclick({e:{row:d,mousePos:a}})};this.callRowHover=function(d){angular.isDefined(c.events)&&c.events.rowHover&&c.events.rowHover({row:d});c.rowHover({e:{row:d}})};this.callRowRightClick=function(d,a){angular.isDefined(c.events)&&c.events.rowRightClick&&c.events.rowRightClick({row:d,mousePos:a});c.rowRightclick({e:{row:d,mousePos:a}})};this.callKeyDown=function(d,a){angular.isDefined(c.events)&&c.events.keyDown?c.events.keyDown({event:d,row:a}):c.keyDown({e:{event:d,row:a}})};this.callKeyPress=function(d,a){angular.isDefined(c.events)&&c.events.keyPress?c.events.keyPress({event:d,row:a}):c.keyPress({e:{event:d,row:a}})};this.callKeyUp=function(d,a){angular.isDefined(c.events)&&c.events.keyUp?c.events.keyUp({event:d,row:a}):c.keyUp({e:{event:d,row:a}})};this.callScrollPosChanged=function(){angular.isDefined(c.events)&&c.events.scrollPosChanged?c.events.scrollPosChanged({scrollPos:b.scrollPos}):c.scrollposChanged({e:{scrollPos:b.scrollPos}})};h.bind("click",function(d){1===d.which&&b.callRowClick(null,b.getMousePos(d))});h.bind("dblclick",function(d){d.preventDefault();1===d.which&&b.callRowDblClick(null,b.getMousePos(d));d.stopPropagation()});h.bind("mousedown",function(d){3===d.which&&b.callRowRightClick(null,b.getMousePos(d));b.removeDropDownList();b.closeFilterWindow();d.stopPropagation()});this.expandList=[];this.expandIndentList=[];var da=function(d,a,c){d.type="row";d[b.options.rowFields.id]||(d[b.options.rowFields.id]=f.getUniqueId());c&&(d[b.options.rowFields.pid]=c);c=!0;var g=d[b.options.rowFields.cells];if(g&&0<g.length){c=xa(d);b.isRowExpanded(d)&&d[b.options.rowFields.rows]&&0<d[b.options.rowFields.rows].length&&(c=c&&b.isThereVisibleChildren(d));for(var m=-1,e="label",h=null,h=null,k=0;k<b.columnList.length;k++){var h=b.columnList[k],m=h[b.options.columnFields.id],e=h[b.options.columnFields.editorType],h=h[b.options.columnFields.editorSettings],l=k;m&&(l=b.getCellIndexById(g,k,m));0<=l&&l<g.length&&(g[l].type="cell",b.setDefaultCellValue(g[l],e,h))}}c&&(b.expandList.push(d),b.expandIndentList.push(a));return c},za=function(d,a,c){var g=!0;if(!d[b.options.rowFields.rows])return g=da(d,a+y,c);if(g=da(d,a+y,c)){c=0;var f=!0;if(b.isRowExpanded(d)){var e=d[b.options.rowFields.rows];if(e){b.applySorting(e);for(var h=0;h<e.length;h++)(f=za(e[h],a+y,d[b.options.rowFields.id]))&&c++}}!b.isThereChildRows&&(0<c||!b.isRowExpanded(d)&&d[b.options.rowFields.rows]&&0<d[b.options.rowFields.rows].length&&b.isThereVisibleChildren(d))&&(b.isThereChildRows=!0)}return g};this.expand=function(d){b.expandList.length=[];b.expandIndentList.length=[];if(!b.isRowExpanded(d)){var a=b.getRowCurrentIndex(d);if(d=b.getList(d)){b.applySorting(d);for(var c=0;c<d.length;c++)za(d[c],b.indentList[a],null)}if(0<b.expandList.length){b.allowEvents=!1;a++;Array.prototype.splice.apply(b.currentList,[a,0].concat(b.expandList));Array.prototype.splice.apply(b.indentList,[a,0].concat(b.expandIndentList));b.getRowScope()?b.updateView():b.updateLayout();var g=e(function(){b.updateViewSize();b.updateViewSize();b.updateScrollView();e.cancel(g);b.allowEvents=!0},1)}}};this.collapse=function(d){b.expandList.length=[];b.expandIndentList.length=[];if(b.isRowExpanded(d)){var a=null,c=!1,g=d,f=-1,h=b.getRowCurrentIndex(d);for(d=b.getParent(d);d&&!c;){a=b.getList(d);for(f=a.indexOf(g)+1;!c&&f<a.length;)g=a[f],0<b.getRowCurrentIndex(g)&&(c=!0),f++;c||(g=d);d=b.getParent(d)}if(!c&&g)for(a=b.getList(),f=a.indexOf(g)+1;f<a.length;)if(g=a[f],0<b.getRowCurrentIndex(g)){c=!0;break}else f++;h++;a=b.currentList.length-h;c&&(a=b.getRowCurrentIndex(g)-h);if(0<a){b.currentList.splice(h,a);b.indentList.splice(h,a);b.getRowScope()?b.updateView():b.updateLayout();var k=e(function(){b.updateViewSize();b.updateViewSize();b.updateScrollView();e.cancel(k);b.allowEvents=!0},1)}}};this.toggle=function(a,c){if(a){if(a[b.options.rowFields.hasChildren]||a[b.options.rowFields.rows]&&0!=a[b.options.rowFields.rows].length)if(!c||0==a[b.options.rowFields.expanded])if(!1!==c||0!=a[b.options.rowFields.expanded]){b.updateType="view";var q=void 0!==c?c:!1!==a[b.options.rowFields.expanded]?!0:!1,g=!0,g=void 0!==c?c?b.callBeforeExpand(a):b.callBeforeCollapse(a):q?b.callBeforeCollapse(a):b.callBeforeExpand(a);!1!==g&&(q=void 0!=c?c:!q,q!=a[b.options.rowFields.expanded]&&(0!=q?b.expand(a):b.collapse(a),a[b.options.rowFields.expanded]=q),b.isRowExpanded(a)?b.callAfterExpand(a):b.callAfterCollapse(a))}}else{q=b.getFullList();for(g=0;g<q.length;g++)q[g][b.options.rowFields.expanded]=c;b.updateCurrentLayout()}};c.$on(c.name+"-begin-load",function(a,c){b.options.loadRow=c});c.$on(c.name+"-collapse",function(a,c){b.toggle(c,!1)});c.$on(c.name+"-end-load",function(a){b.options.loadRow=null});c.$on(c.name+"-expand",function(a,c){b.toggle(c,!0)});c.$on(c.name+"-expand-col-index",function(a,c){0<=c&&c<b.columnList.length&&(b.options.expandColIndex=c)});c.$on(c.name+"-toggle",function(a,c){b.toggle(c)});this.isFilteringAllowed=function(a){return a&&a[b.options.columnFields.allowFilter]};c.$on(c.name+"-filter",function(a,c,q){b.filter(c,q)});this.filter=function(a,c){if(a)a[b.options.columnFields.filterParams]=c;else for(var q=0;q<b.columnList.length;q++)a[b.options.columnFields.filterParams]=null;b.closeFilterWindow();b.updateCurrentLayout()};this.callGotFocus=function(a,b,q,g,f){angular.isDefined(c.events)&&c.events.gotFocus?c.events.gotFocus({event:a,row:b,cell:q,edit:void 0!=g?!0:!1,editValue:f}):c.gotFocus({e:{event:a,row:b,cell:q,edit:void 0!=g?!0:!1,editValue:f}})};this.callLostFocus=function(a,b,q,g,f){angular.isDefined(c.events)&&c.events.lostFocus?c.events.lostFocus({event:a,row:b,cell:q,edit:void 0!=g?!0:!1,editValue:f}):c.lostFocus({e:{event:a,row:b,cell:q,edit:void 0!=g?!0:!1,editValue:f}})};this.getTabIndex=function(){return h[0].attributes&&h[0].attributes.tabindex?h[0].attributes.tabindex.value:""};this.updateFocus=function(a,c){if(1==b.options.allowFocus)var f=e(function(){if(b.isRowIndexInRange(a)){var g=b.getElemFromRow(b.currentList[a]);g&&(1==b.options.allowCellFocus&&0<=c&&c<b.columnList.length?(g=b.getElemFromCell(a,c))&&g[0].focus():g[0].focus())}else h[0].focus();e.cancel(f)},5)};c.$on(c.name+"-focus",function(a,c,f){b.updateFocus(c,f)});var x=!1;this.getCell=function(a,c){if(0<=a&&a<b.currentList.length){var f=b.currentList[a],g=b.getColumnRealIndex(c);0<=c&&c<b.columnList.length&&(g=b.getCellIndexById(f[b.options.rowFields.cells],c,b.columnList[c].id));if(f[b.options.rowFields.cells]&&0<=g&&g<f[b.options.rowFields.cells].length)return f[b.options.rowFields.cells][g]}return null};this.getCellObject=function(a,c){if(0<=a&&a<b.currentList.length){var f=b.currentList[a],g=b.getColumnRealIndex(c);0<=c&&c<b.columnList.length&&(g=b.getCellIndexById(f[b.options.rowFields.cells],c,b.columnList[c].id));if(f[b.options.rowFields.cells]&&0<=g&&g<f[b.options.rowFields.cells].length)return f[b.options.rowFields.cells][g]}return null};this.getCellIndexById=function(a,c,f){var g=-1;if(a){c=b.getColumnRealIndex(c);for(var e=0;e<a.length;e++)if(void 0==a[e][b.options.cellFields.cid]){g=c;break}else if(a[e][b.options.cellFields.cid]==f){g=e;break}}return g};this.getCellIndexFromRow=function(a,c){var f=-1;if(a&&c&&c[b.options.rowFields.cells])for(var g=0;g<c[b.options.rowFields.cells].length;g++)if(c[b.options.rowFields.cells][g]==a){f=g;break}return f};this.getColumnById=function(a){for(var c=null,f=0;f<b.columnList.length;f++)if(b.columnList[f][b.options.columnFields.id]==a){c=b.columnList[f];break}return c};this.getColumnObject=function(a){return 0<=a&&a<b.columnList.length?b.columnList[a]:null};this.getRowObject=function(a){return 0<=a&&a<b.currentList.length?b.currentList[a]:null};this.isRowExpanded=function(a){return a?a[b.options.rowFields.expanded]||void 0===a[b.options.rowFields.expanded]?!0:!1:!0};this.getContentElement=function(a,b){var c=null;b||(b="cell-content");if(a&&0<a.children().length)for(var g=a.children(),f=0;f<g.length;f++){var e=angular.element(g.eq(f));if(e[0].attributes&&e[0].attributes["data-element"]&&e[0].attributes["data-element"].value==b){c=e;break}}return c};this.getElement=function(a,b){var c=null;b||(b="cell-content");if(a&&0<a.children().length){a=a.children().eq(0);for(var g=a.children(),f=0;f<g.length;f++){var e=angular.element(g.eq(f));if(e[0].attributes&&e[0].attributes["data-element"]&&e[0].attributes["data-element"].value==b){c=e;break}}}return c};this.getChildElement=function(a,b){var c=null;b||(b="content");if(a&&0<a.children().length)for(var g=a.children(),f=0;f<g.length;f++){var e=angular.element(g.eq(f));if(e[0].attributes&&e[0].attributes["data-element"]&&e[0].attributes["data-element"].value==b){c=e;break}}return c};this.getElemFromColumn=function(a,c){var f=null;if(a){var g=b.getColumnCurrentIndex(a),e=b.getHeaderElem();"footer"==c&&(e=b.getFooterElem());if(e&&(e=e.find("td"))&&0<e.length)for(var h=0;h<e.length;h++){var k=angular.element(e[h]);if(k[0].attributes["data-index"]&&k[0].attributes["data-index"].value.toString()===g.toString()){f=k;break}}}return f};this.getElemFromRow=function(a){var c=null;if(a){a=b.getRowCurrentIndex(a);var f=b.getRowElems();if(f&&0<f.length)for(var g=0;g<f.length;g++){var e=angular.element(f[g]);if(e[0].attributes["data-index"]&&e[0].attributes["data-index"].value.toString()===a.toString()){c=e;break}}}return c};this.getElemFromCell=function(a,c){var f=null;if(0<=a&&a<b.currentList.length){var g=b.getElemFromRow(b.currentList[a]);if(g&&(g=g.find("td"))&&0<g.length)for(var e=0;e<g.length;e++){var h=angular.element(g[e]);if(h[0].attributes["data-index"]&&h[0].attributes["data-index"].value.toString()===c.toString()){f=h;break}}}return f};this.getIndent=function(a){var c=0;if(a)for(parent=b.rowsObj.getParent(a);parent;)c+=b.options.indent,parent=b.rowsObj.getParent(parent);return c};this.getObjState=function(a){if(a)switch(a.type){case "column":if(1==a.selected)return"selected";if(a==b.hoverColumn)return"hovered";break;case "row":if(0==a[b.options.rowFields.enabled])return"disabled";if(1==a.selected)return"selected";if(a==b.hoverRow)return"hovered";break;case "cell":if(0==a[b.options.cellFields.enabled])return"disabled";if(1==a.selected)return"selected";if(a==b.hoverCell)return"hovered"}return"normal"};this.getRowAt=function(a,c){var e=null,g=null,h=null,k=b.getRowElems();if(k&&0<k.length)for(var l=0;l<k.length;l++)if(e=angular.element(k[l]),g=f.getPageRect(e),f.checkHit(a,c,g)){h=b.getRowFromElem(e);break}return h};this.getRowCurrentIndex=function(a){return a&&b.currentList?b.currentList.indexOf(a):-1};this.getObjCurrentIndex=function(a){return b.getRowCurrentIndex(a)};this.getRowFromChildElem=function(a){if(a&&(a=angular.element(a))){for(a=a.parent();a&&a[0].tagName&&"tr"!==a[0].tagName.toLowerCase();)a=a.parent();return a?b.getRowFromElem(a):null}return null};this.getColumnCurrentIndex=function(a){return a&&b.columnList?b.columnList.indexOf(a):-1};this.getColumnRealIndex=function(a){var c=b.columnsObj.getList();return 0<=a&&a<c.length&&a<b.columnList.length?c.indexOf(b.columnList[a]):-1};this.getColumnFromChildElem=function(a){return a?b.getColumnFromElem(a):null};this.getColumnFromElem=function(a){return a&&(a=angular.element(a))&&a[0].attributes["data-index"]&&(a=a[0].attributes["data-index"].value,0<=a&&a<b.columnList.length)?b.columnList[a]:null};this.getIndexFromElem=function(a){return a&&(a=angular.element(a))&&a[0].attributes["data-index"]?a[0].attributes["data-index"].value:-1};this.getRowFromElem=function(a){if(a&&(a=angular.element(a))&&a[0].attributes["data-index"]&&(a=a[0].attributes["data-index"].value,b.isRowIndexInRange(a)))return b.currentList[a]};this.isRowIndexInRange=function(a){return 0<=a&&a<b.currentList.length};this.isColIndexInRange=function(a){return 0<=a&&a<b.columnList.length};this.isRowEnabled=function(a){return a&&f.isEnabled(a[b.options.rowFields.enabled])};this.mouseButtonStatus=function(a){x=a};c.$on(c.name+"-ensure-visible",function(a,c){b.ensureVisible(c)});c.$on(c.name+"-find-row-by-id",function(a,c){v.setTempData(b.findRowById(c))});c.$on(c.name+"-find-row-by-path",function(a,c,f){v.setTempData(b.findRowByPath(c,f))});c.$on(c.name+"-find-row-by-text",function(a,c){v.setTempData(b.findRowByText(c))});c.$on(c.name+"-get-full-path",function(a,c){v.setTempData(b.getFullPath(c))});c.$on(c.name+"-get-row-level",function(a,c){v.setTempData(b.getLevel(c))});c.$on(c.name+"-get-row-parent",function(a,c){v.setTempData(b.getParent(c))});c.$on(c.name+"-get-flat-list",function(a,c){c?v.setTempData(b.getFullList()):v.setTempData(b.currentList)});c.$on(c.name+"-get-list",function(a,c){v.setTempData(b.getList(c))});this.ensureVisible=function(a){if(a){for(var c=[],f=b.getParent(a);f;)c.push(f),f=b.getParent(f);for(f=c.length-1;0<=f;f--)c[f][b.options.rowFields.expanded]=!0;b.updateCurrentLayout();var g=e(function(){b.scrollTo(a,"center");e.cancel(g)},100)}};this.findRowById=function(a){return b.rowsObj.findObjectById(a)};this.findRowByText=function(a){return b.rowsObj.findObjectByText(a)};this.findRowByPath=function(a,c){var f=null;c||(c=b.getFullList());for(var g=0;g<c.length;g++)if(b.getFullPath(c[g])==a){f=c[g];break}return f};this.getFullPath=function(a){var c="";if(a)for(c=a[b.options.rowFields.text],a=b.getParent(a);a;)c=[a[b.options.rowFields.text],b.options.pathSeparator,c].join(""),a=b.getParent(a);return c};this.getLevel=function(a){var b=0;for(a=this.getParent(a);a;)b++,a=this.getParent(a);return b};this.getParent=function(a){return b.rowsObj.getParent(a)};this.getList=function(a){return b.rowsObj.getList(a)};this.getFirstRow=function(){for(var a=null,c=0;c<b.currentList.length;c++)if(f.isEnabled(b.currentList[c][b.options.rowFields.enabled])){a=b.currentList[c];break}return a};this.getPrevRow=function(a){var c=null;if(0<=a&&a<b.currentList.length)for(--a;0<=a;a--)if(f.isEnabled(b.currentList[a][b.options.rowFields.enabled])){c=b.currentList[a];break}return c};this.getNextRow=function(a){var c=null;for(a+=1;a<b.currentList.length;a++)if(f.isEnabled(b.currentList[a][b.options.rowFields.enabled])){c=b.currentList[a];break}return c};this.getLastRow=function(){for(var a=null,c=b.currentList.length-1;0<=c;c--)if(f.isEnabled(b.currentList[c][b.options.rowFields.enabled])){a=b.currentList[c];break}return a};this.updateSelectionStatus=function(a){switch(a){case "shift":switch(b.options.selectionMode){case "multi-simple":b.multiSelection(!0);break;case "multi-extended":b.multiSelection(!0);break;default:b.multiSelection(!1)}break;case "ctrl":switch(b.options.selectionMode){case "multi-simple":b.multiSelection(!0);break;case "multi-extended":b.multiSelection(!0);break;default:b.multiSelection(!1)}}};h.bind("keydown",function(a){switch(a.keyCode){case 16:b.updateSelectionStatus("shift");break;case 17:b.updateSelectionStatus("ctrl");break;default:(a.ctrlKey||a.metaKey)&&b.updateSelectionStatus("ctrl"),a.shiftKey&&b.updateSelectionStatus("shift")}});this.allowUpdate=!0;this.updateType="all";this.suspendLayout=function(){b.allowUpdate=!1};this.resumeLayout=function(){b.allowUpdate=!0;b.updateLayout()};c.$on(c.name+"-refresh",function(a,c,f){b.refresh(c,f)});c.$on(c.name+"-resume-layout",function(a){b.resumeLayout()});c.$on(c.name+"-suspend-layout",function(a){b.suspendLayout()});c.$on(c.name+"-update-layout",function(a){b.updateLayout()});c.$on(c.name+"-update-view",function(a){b.updateView()});c.$on(c.name+"-get-scroll-pos",function(a){v.setTempData(b.getScrollPos())});c.$on(c.name+"-set-scroll-pos",function(a,c){b.setScrollPos(c)});c.$on(c.name+"-scroll-to",function(a,c,f){b.scrollTo(c,f)});var ea=!1;this.multiSelection=function(a){if(void 0!=a)ea=a;else return ea};this.columnSelection=function(a,e){if(a){var h=!0;b.options.selectedColumn&&(h=!f.isEqual(b.options.selectedColumn[b.options.columnFields.id],a[b.options.columnFields.id]));var g=!0,g=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({object:a}):c.beforeSelect({e:{object:a}});h&&!1!==g&&(b.options.selectedColumn&&(b.options.selectedColumn.selected=!1,b.refresh(b.options.selectedColumn)),b.options.selectedColumn=a,a.selected=!0,angular.isDefined(c.selectedColumn)&&(c.selectedColumn=a),b.refresh(b.options.selectedColumn),b.callAfterSelect(a))}else return b.options.selectedColumn};this.isRowSelected=function(a){return f.isSelected(a)};this.clearPrevSelection=function(a){for(var c=0;c<b.options.selectedRows.length;c++)a&&!f.isEqual(b.options.selectedRows[c][b.options.rowFields.id],a[b.options.rowFields.id])?b.options.selectedRows[c].selected=!1:a||(b.options.selectedRows[c].selected=!1);b.options.selectedRows.length=0;a&&0!=a[b.options.rowFields.enabled]&&b.options.selectedRows.push(a);b.refreshRows()};this.markSelColumn=function(){for(var a=0;a<b.columnList.length;a++)b.refresh(b.columnList[a])};this.rowSelection=function(a,e,h,g){if(a){if("none"!=b.options.selectionMode)if(b.isRowEnabled(a)){h=b.rowSelection();var k=!0;h&&(k=!f.isEqual(h[b.options.rowFields.id],a[b.options.rowFields.id]));var l=!0,l=angular.isDefined(c.events)&&c.events.beforeSelect?c.events.beforeSelect({object:a}):c.beforeSelect({e:{object:a}});if(!1!==l)if(k){k=!0;"multi-extended"==b.options.selectionMode&&(k=!b.isObjInSelList(a));k&&(x&&e?b.clearPrevSelection():ea||"multi-simple"===b.options.selectionMode||b.clearPrevSelection());b.options.selectedRow=a;if(x&&e&&"one"!=b.options.selectionMode){if(e=b.getRowCurrentIndex(h),g=b.getRowCurrentIndex(a),e>g&&(h=e,e=g,g=h),b.isRowIndexInRange(e)&&b.isRowIndexInRange(g))for(;e<=g;e++)b.currentList[e].selected=!0,b.options.selectedRows.push(b.currentList[e])}else x&&(ea||"multi-simple"===b.options.selectionMode)?(e=null===a.selected||"undefined"===a.selected?!1:a.selected,a.selected=!e,a.selected?b.isObjInSelList(a)||b.options.selectedRows.push(a):b.options.selectedRows=b.options.selectedRows.filter(function(b){return b!=a})):(a.selected=!0,b.isObjInSelList(a)||b.options.selectedRows.push(a));angular.isDefined(c.selectedRow)&&(c.selectedRow=a);b.callAfterSelect(a);b.refresh(null,null,!0)}else if(ea||"multi-simple"===b.options.selectionMode)e=null===a.selected||"undefined"===a.selected?!1:a.selected,g&&"undefined"!==g&&(e=g),a.selected=!e,a.selected?b.isObjInSelList(a)||b.options.selectedRows.push(a):b.options.selectedRows=b.options.selectedRows.filter(function(b){return b!=a}),b.callAfterSelect(a),b.refresh(null,null,!0)}else b.clearPrevSelection()}else return b.options.selectedRow};this.updateSelection=function(a,c){"multi-simple"!==b.options.selectionMode&&0<b.options.selectedRows.length&&!c&&!ea&&b.clearPrevSelection(a)};this.isObjInSelList=function(a){var c=!1,e=b.options.selectedRows;if(a&&e)for(var g=0;g<e.length;g++)if(f.isEqual(e[g][b.options.rowFields.id],a[b.options.rowFields.id])){c=!0;break}return c};this.markSelRows=function(){var a=b.getRowElems();if(a&&0<a.length)for(var c=0;c<a.length;c++){var f=b.getRowFromElem(a[c]);f&&b.refresh(f)}};c.$on(c.name+"-get-selected-column",function(a){v.setTempData(b.columnSelection())});c.$on(c.name+"-set-selected-column",function(a,c){b.columnSelection(c)});c.$on(c.name+"-get-selected-row",function(a){v.setTempData(b.rowSelection())});c.$on(c.name+"-set-selected-row",function(a,c){var f=e(function(){b.rowSelection(c);e.cancel(f)},1)});c.$on(c.name+"-get-selected-rows",function(a){v.setTempData(b.options.selectedRows)});c.$watch("options.allowCellFocus",function(a,c){a!==c&&(b.options.allowCellFocus=a)});c.$watch("allowCellFocus",function(a,c){a!==c&&(b.options.allowCellFocus=a)});c.$watch("options.allowColumnReorder",function(a,c){a!==c&&(b.options.allowColumnReorder=a)});c.$watch("allowColumnReorder",function(a,c){a!==c&&(b.options.allowColumnReorder=a)});c.$watch("allowFilter",function(a,c){a!==c&&(b.options.allowFilter=a)});c.$watch("options.allowFocus",function(a,c){a!==c&&(b.options.allowFocus=a)});c.$watch("allowFocus",function(a,c){a!==c&&(b.options.allowFocus=a)});c.$watch("options.allowDrag",function(a,c){a!==c&&(b.options.allowDrag=a,b.updateView())});c.$watch("allowDrag",function(a,c){a!==c&&(b.options.allowDrag=a,b.updateView())});c.$watch("options.allowDrop",function(a,c){a!==c&&(b.options.allowDrop=a,b.updateView())});c.$watch("allowDrop",function(a,c){a!==c&&(b.options.allowDrop=a,b.updateView())});c.$watch("autoExpand",function(a,c){a!==c&&(b.options.autoExpand=a)});c.$watch("controlStyle",function(a,c){a!==c&&b.updateControlStyle(a)});c.$watch("editorSettings",function(a,c){a!==c&&b.updateEditorSettings(a)});c.$watch("expandingColumnIndex",function(a,c){a!==c&&(b.options.expandColIndex=a)});c.$watch("fields",function(a,c){a!==c&&(b.updateDataFields(a),b.UpdateData())});c.$watch("options.fillSpace",function(a,c){a!==c&&(b.options.fillSpace=a)});c.$watch("fillSpace",function(a,c){a!==c&&(b.options.fillSpace=a)});c.$watch("options.gridLines",function(a,c){a!==c&&(b.options.gridLines=a,b.updateView())});c.$watch("gridLines",function(a,c){a!==c&&(b.options.gridLines=a,b.updateView())});c.$watch("options.hoverSelection",function(a,c){a!==c&&(b.options.hoverSelection=a)});c.$watch("hoverSelection",function(a,c){a!==c&&(b.options.hoverSelection=a)});c.$watch("options.rowIcon",function(a,c){a!==c&&(b.options.rowIcon=a,b.updateLayout())});c.$watch("rowIcon",function(a,c){a!==c&&(b.options.rowIcon=a,b.updateLayout())});c.$watch("options.labelEdit",function(a,c){a!==c&&(b.options.labelEdit=a)});c.$watch("labelEdit",function(a,c){a!==c&&(b.options.labelEdit=a)});c.$watch("options.pathSeparator",function(a,c){a!==c&&(b.options.pathSeparator=a)});c.$watch("pathSeparator",function(a,c){a!==c&&(b.options.pathSeparator=a)});c.$watch("options.rtl",function(a,c){a!==c&&(b.options.rtl=a,b.updateLayout())});c.$watch("rtl",function(a,c){a!==c&&(b.options.rtl=a,b.updateLayout())});b.resetSelection=function(){switch(b.options.selectionMode){case "none":b.clearPrevSelection();break;default:b.clearPrevSelection(b.rowSelection())}};c.$watch("options.selectionMode",function(a,c){a!==c&&(b.options.selectionMode=a,b.resetSelection())});c.$watch("selectionMode",function(a,c){a!==c&&(b.options.selectionMode=a,b.resetSelection())});c.$watch("options.showFooter",function(a,c){a!==c&&(b.options.showFooter=a,b.updateLayout())});c.$watch("showFooter",function(a,c){a!==c&&(b.options.showFooter=a,b.updateLayout())});c.$watch("options.showHeader",function(a,c){a!==c&&(b.options.showHeader=a,b.updateLayout())});c.$watch("showHeader",function(a,c){a!==c&&(b.options.showHeader=a,b.updateLayout())});c.$watch("options.showIcons",function(a,c){a!==c&&(b.options.showIcons=a,b.updateLayout())});c.$watch("showIcons",function(a,c){a!==c&&(b.options.showIcons=a,b.updateLayout())});c.$watch("options.selectedRow",function(a,c){a!==c&&(c&&(c.selected=!1),b.options.selectedRow=a,b.callAfterSelect(a))});c.$watch("selectedRow",function(a,c){a!==c&&(c&&(c.selected=!1),b.options.selectedRow=a,b.callAfterSelect(a))});this.sortComparer=this.sortColumn=null;c.$watch("sorting",function(a,c){a!==c&&(b.options.sorting=a)});c.$on(c.name+"-sort",function(a,c,f,g){b.sort(c,f,g)});this.sort=function(a,c,f){b.sortColumn=a;b.sortComparer=f;if("ascending"==c||"descending"==c||"none"==c)b.options.sorting=c;b.updateCurrentLayout()};this.getCellIndexInCollection=function(a,c,f){var g=-1;if(a)for(var e=0;e<a.length;e++)if(void 0==a[e][b.options.cellFields.cid]){g=c;break}else if(a[e][b.options.cellFields.cid]==f){g=e;break}return g};this.isSortingAllowed=function(){return"ascending"==b.options.sorting||"descending"==b.options.sorting};this.applySorting=function(a){if(a&&(!b.sortColumn||0!=b.sortColumn[b.options.columnFields.visible])){var c=b.getColumnCurrentIndex(b.sortColumn),e=0<=c?c:b.options.expandColIndex;if(e<b.columnList.length){var g=b.columnList[e][b.options.columnFields.id];b.sortColumn&&b.sortColumn[b.options.columnFields.comparer]?a.sort(b.sortColumn[b.options.columnFields.comparer]):b.sortComparer?a.sort(b.sortComparer):b.isSortingAllowed()&&a.sort(function(a,c){var d=null,h=null;if(a[b.options.rowFields.cells]){var k=b.getCellIndexInCollection(a[b.options.rowFields.cells],e,g);0<=k&&((d=a[b.options.rowFields.cells][k][b.options.cellFields.value])||(d=a[b.options.rowFields.cells][k][b.options.cellFields.text]),f.isObject(d)&&(d=d.value?d.value:d.text))}c[b.options.rowFields.cells]&&(k=b.getCellIndexInCollection(c[b.options.rowFields.cells],e,g),0<=k&&((h=c[b.options.rowFields.cells][k][b.options.cellFields.value])||(h=c[b.options.rowFields.cells][k][b.options.cellFields.text]),f.isObject(h)&&(h=h.value?h.value:h.text)));d=void 0!=d?d:null;h=void 0!=h?h:null;switch(b.options.sorting){case "ascending":if(d<h)return-1;if(d>h)return 1;break;case "descending":if(d>h)return-1;if(d<h)return 1;break;default:return 0}})}}};var sa=function(a){if(a){var c=f.isFieldAvailable(a.general,"iui-treegrid-column"),e;e=(e=a.header)?{content:f.isFieldAvailable(e.content,"iui-treegrid-column-header-cell-content"),disabled:f.isFieldAvailable(e.disabled,"iui-treegrid-column-header-disabled"),normal:f.isFieldAvailable(e.normal,"iui-treegrid-column-header"),hovered:f.isFieldAvailable(e.hovered,"iui-treegrid-column-header-hovered"),selected:f.isFieldAvailable(e.selected,"iui-treegrid-column-header-selected")}:b.options.controlStyle.column.header;a=(a=a.footer)?{content:f.isFieldAvailable(a.content,"iui-treegrid-column-footer-cell-content"),disabled:f.isFieldAvailable(a.disabled,"iui-treegrid-column-footer-disabled"),normal:f.isFieldAvailable(a.normal,"iui-treegrid-column-footer"),hovered:f.isFieldAvailable(a.hovered,"iui-treegrid-column-footer-hovered"),selected:f.isFieldAvailable(a.selected,"iui-treegrid-column-footer-selected")}:b.options.controlStyle.column.footer;return{general:c,header:e,footer:a}}return b.options.controlStyle.column};this.getExpandBoxStyle=function(a){return a?{general:f.isFieldAvailable(a.general,"iui-treegrid-expand-box"),animated:f.isFieldAvailable(a.animated,"iui-treegrid-expand-box-load"),expanded:f.isFieldAvailable(a.expanded,"iui-treegrid-expand-box-open"),collapsed:f.isFieldAvailable(a.collapsed,"iui-treegrid-expand-box-close")}:b.options.controlStyle.row.expandBox};var fa=function(a){if(a){var c;c=(c=a.general)?{disabled:f.isFieldAvailable(c.disabled,"iui-treegrid-row-disabled"),focused:f.isFieldAvailable(c.focused,"iui-treegrid-row-focused"),normal:f.isFieldAvailable(c.normal,"iui-treegrid-row"),hovered:f.isFieldAvailable(c.hovered,"iui-treegrid-row-hovered"),selected:f.isFieldAvailable(c.selected,"iui-treegrid-row-selected")}:b.options.controlStyle.row.general;var e;var g=a.checkBox;g?(e=f.isFieldAvailable(g.general,"iui-checkbox"),g=(g=g.box)?{general:f.isFieldAvailable(g.general,"iui-checkbox-box"),disabled:f.isFieldAvailable(g.disabled,"iui-checkbox-disabled"),checked:f.isFieldAvailable(g.checked,"iui-checkbox-checked"),indeterminate:f.isFieldAvailable(g.indeterminate,"iui-checkbox-indeterminate"),unchecked:f.isFieldAvailable(g.unchecked,"iui-checkbox-unchecked")}:b.options.controlStyle.row.checkBox.box,e={general:e,box:g}):e=b.options.controlStyle.row.checkBox;g=b.getExpandBoxStyle(a.expandBox);a=(a=a.cell)?{content:f.isFieldAvailable(a.content,"iui-treegrid-row-cell-content"),general:f.isFieldAvailable(a.general,"iui-treegrid-row-cell"),disabled:f.isFieldAvailable(a.disabled,"iui-treegrid-row-cell-disabled"),focused:f.isFieldAvailable(a.focused,"iui-treegrid-row-cell-focused"),normal:f.isFieldAvailable(a.normal,"iui-treegrid-row-cell"),hovered:f.isFieldAvailable(a.hovered,"iui-treegrid-row-cell-hovered"),selected:f.isFieldAvailable(a.selected,"iui-treegrid-row-cell-selected")}:b.options.controlStyle.row.cell;return{general:c,checkBox:e,expandBox:g,cell:a}}return b.options.controlStyle.row},ba=function(a){return a?{content:f.isFieldAvailable(a.content,"iui-treegrid-row-cell-content"),general:f.isFieldAvailable(a.general,"iui-treegrid-row-cell"),disabled:f.isFieldAvailable(a.disabled,"iui-treegrid-row-cell-disabled"),focused:f.isFieldAvailable(a.focused,"iui-treegrid-row-cell-focused"),normal:f.isFieldAvailable(a.normal,"iui-treegrid-row-cell"),hovered:f.isFieldAvailable(a.hovered,"iui-treegrid-row-cell-hovered"),selected:f.isFieldAvailable(a.selected,"iui-treegrid-row-cell-selected")}:b.options.controlStyle.cell};this.updateControlStyle=function(a){b.options.controlStyle=a?{general:f.isFieldAvailable(a.general,"iui-treegrid"),column:sa(a.column),row:fa(a.row),cell:ba(a.cell)}:{general:f.isFieldAvailable(b.defaultStyle.general,"iui-treegrid"),column:sa(b.defaultStyle.column),row:fa(b.defaultStyle.row),cell:ba(b.defaultStyle.cell)}};this.getCurrentColumnStyle=function(a,c,f){var e=b.options.controlStyle.column;a&&a.style&&(e=a.style);a=b.options.controlStyle.column.body;var h=e.body;switch(c){case "header":a=b.options.controlStyle.column.header;h=e.header;break;case "footer":a=b.options.controlStyle.column.footer,h=e.footer}if(f)switch(f){case "content":return h&&h.content?h.content:a.content;case "disabled":return h&&h.disabled?h.disabled:a.disabled;case "hovered":return h&&h.hovered?h.hovered:a.hovered;case "selected":return h&&h.selected?h.selected:a.selected;default:return h&&h.normal?h.normal:a.normal}else return c?h?h:a:e?e:b.options.controlStyle.column};this.getCurrentRowStyle=function(a,c){var e=b.options.controlStyle.row;if(a)switch(a.style){case "initial":break;case "parent":return b.getCurrentRowStyle(b.getParent(a),c);default:null!=a.style&&(e=a.style)}if(c){if(f.isString(e.general))return e.general;switch(c){case "disabled":return e.general&&e.general.disabled?e.general.disabled:b.options.controlStyle.row.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:b.options.controlStyle.row.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:b.options.controlStyle.row.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:b.options.controlStyle.row.general.selected;default:return e.general&&e.general.normal?e.general.normal:b.options.controlStyle.row.general.normal}}else return e?e:b.options.controlStyle.row};this.getDefaultCellContentClass=function(){return"iui-treegrid-row-cell-content"};this.getDefaultCellLabelClass=function(){return"iui-treegrid-row-cell-label"};this.getDefaultCellBorderClass=function(){return"iui-treegrid-lines-both"};this.getCurrentCellStyle=function(a,c,e){var f=b.options.controlStyle.row.cell;if(c)switch(c.style){case "initial":break;case "parent":a&&(f=ba(b.getCurrentRowStyle(a)));break;default:c.style&&(f=c.style)}if(e)switch(e){case "content":return f.content?f.content:b.options.controlStyle.cell.content;case "disabled":return f.disabled?f.disabled:b.options.controlStyle.cell.disabled;case "focused":return f.focused?f.focused:b.options.controlStyle.cell.focused;case "hovered":return f.hovered?f.hovered:b.options.controlStyle.cell.hovered;case "selected":return f.selected?f.selected:b.options.controlStyle.cell.selected;default:return f.normal?f.normal:b.options.controlStyle.cell.normal}else return f?f:b.options.controlStyle.row.cell}}]).directive("iuiTreegrid",["$compile","$timeout","$interval","IntegralUIInternalService","IntegralUIDragDrop","$window","IntegralUIListCtrlService",function(c,h,e,k,f,C,v){return{restrict:"EA",controller:"IntegralUITreeGridController",transclude:!0,replace:!0,template:'<div class="iui-treegrid" data-element="treegrid"><div class="iui-treegrid-block"></div></div>',scope:{allowAnimation:"=",allowCellFocus:"=",allowColumnReorder:"=",allowFilter:"=",allowFocus:"=",allowDrag:"=",allowDrop:"=",animationSpeed:"=",autoExpand:"=",columns:"=",controlStyle:"=",editorSettings:"=",expandingColumnIndex:"=",fields:"=",fillSpace:"=",gridLines:"=",hoverSelection:"=",labelEdit:"=",name:"@",options:"=?",pathSeparator:"@",rowIcon:"=",rows:"=",selectedIndex:"=",selectedRow:"=",selectionMode:"@",showFooter:"=",showHeader:"=",showIcons:"=",sorting:"@",afterCollapse:"&",afterExpand:"&",afterLabelEdit:"&",afterSelect:"&",beforeCollapse:"&",beforeExpand:"&",beforeLabelEdit:"&",beforeSelect:"&",cellClick:"&",cellvalueChanged:"&",cellvalueChanging:"&",clearColumns:"&",clearRows:"&",columnAdded:"&",columnAdding:"&",columnClick:"&",columnDblclick:"&",columnHover:"&",columnPoschanging:"&",columnPoschanged:"&",columnRemoved:"&",columnRemoving:"&",columnRightclick:"&",columnSizechanged:"&",dragDrop:"&",dragEnter:"&",dragLeave:"&",dragOver:"&",events:"=?",gotFocus:"&",keyDown:"&",keyPress:"&",keyUp:"&",lostFocus:"&",rowAdded:"&",rowAdding:"&",rowClick:"&",rowDblclick:"&",rowHover:"&",rowRemoved:"&",rowRemoving:"&",rowRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(l,p,b,a,xa){var y=this,P=p.children().eq(0),D=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),G=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),ra=angular.element('<div class="iui-scrollbar-corner"></div>'),T=null,Q=null,da=null,za=!1,x=angular.element('<input type="text" class="iui-label-editor" draggable="false" />');a.labelEditStatus=function(a){if(void 0!=a)za=a;else return za};var ea=function(){var b="iui-treegrid-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};l.$on("destroy",function(a){y.s2t();U&&U.unbind("mousedown");p.unbind("click dblclick dragenter dragleave dragend drop keydown mousedown mouseleave mousemove mousewheel scroll");angular.element(C).unbind("dragenter dragover dragend mousemove mousedown mouseup");x&&x.unbind("blur focus keydown mousedown");Ya();A&&A.$destroy();t&&t.$destroy()});a.dragIcon=document.createElement("img");a.dragIcon.width=1;p.append(a.getDropMarkWindow());a.dropMark();a.addDropMark=function(){var b;b=p[0];for(var c=null;b;){if(b===document.getElementsByTagName("body")[0]){c=b;break}b=b.offsetParent}if(b=c)angular.element(b).append(a.getDropMarkWindow()),a.dropMark()};a.removeDropMark=function(){a.getDropMarkWindow().remove()};a.isDropInRange=function(b){b=a.getMousePos(b);var c=p[0].getBoundingClientRect();b.x-=angular.element(C)[0].pageXOffset;b.y-=angular.element(C)[0].pageYOffset;var d=c.top+X,c=c.bottom-ga;N&&G&&(c-=G[0].offsetHeight);return b.y<d||b.y>c?!1:!0};var sa=function(b,c,u){a.options.labelEdit&&(void 0===u&&(u=500),Q=h(function(){if(Q)var a=h(function(){d(b,c,!0);h.cancel(a)},u);h.cancel(Q)},u/3))},fa=null,ba=null,d=function(b,c,u){var r=a.getRowFromChildElem(c);if(r){var B=a.getRowCurrentIndex(r),f=a.getIndexFromElem(c),e=a.getCellObject(B,f),g="",g=c.children().eq(0);if(e)if(u){if(0!=a.callBeforeEdit(e)){fa=r;ba=e;a.labelEditStatus(!0);x.unbind("blur focus keydown mousedown");b=parseInt(getComputedStyle(c[0]).width,10)-4;u=parseInt(getComputedStyle(c[0]).height,10)-3;x.css("width",b+"px");x.css("height",u+"px");g.append(x);x[0].value=e[a.options.cellFields.text];x.bind("keydown",function(b){switch(b.keyCode){case 13:e[a.options.cellFields.text]=x[0].value?x[0].value:"null";d(b,c,!1);break;case 27:d(b,c,!1)}b.stopPropagation()});x.bind("focus",function(b){var c=angular.element(this);a.callGotFocus(b,fa,ba,!0,c[0].value)});x.bind("blur",function(a){d(a)});x.bind("mousedown",function(a){a.stopPropagation()});var k=h(function(){x[0].focus();x[0].select();h.cancel(k)},10)}}else g=x[0].value,a.labelEditStatus(!1),x.unbind("blur focus keydown"),x.remove(),a.updateView(),a.updateFocus(B,f),a.callAfterEdit(e),a.callLostFocus(b,r,e,!0,g),ba=fa=null}else g=x[0].value,a.labelEditStatus(!1),x.unbind("blur focus keydown mousedown"),x.remove(),a.callAfterEdit(),a.updateView(),a.callLostFocus(b,fa,ba,!0,g),ba=fa=null},oa=null,q=angular.element('<div class="iui-dropdown-mark"><span></span></div>'),g=function(a,b){!a||qa&&!b||(a.append(q),q.css("right",0),q.css("height",getComputedStyle(a[0]).height))},m=function(a){!q||qa&&!a||q.remove()},wa=function(b,c){var d=null,r="label";b&&(d=a.getColumnById(b[a.options.cellFields.cid]));!d&&0<=c&&c<a.columnList.length&&(d=a.columnList[c]);d&&(r=d[a.options.columnFields.editorType]);return r},pa=k.getBodyElem(p[0]),ya=k.getUniqueId(4),M=null,qa=!1,Za=0,vb=function(b,d){if(pa&&b.items&&0<b.items.length){var u=k.getUniqueId(4),r=c('<iui-list name="'+u+'" style="position:absolute;top:-99px;height:100px" items="data['+d+"].column."+a.options.columnFields.editorSettings+'.items"></iui-list>')(A);angular.element(pa).append(r);v.updateLayout(u);var B=h(function(){if(0<r.children().length){var a=r.children().eq(0);0<a.children().length&&(Za=angular.element(a.children().eq(0))[0].offsetHeight)}r.remove();h.cancel(B)},1)}},Oa=function(b,d,u,r){var B=a.getCell(u,r);if(B!=oa&&(oa=B,M&&M.remove(),pa)){var e='<iui-list name="'+ya+'" style="position:absolute;"',e=e+(' items="data['+r+"].column."+a.options.columnFields.editorSettings+'.items"'),e=e+(' item-icon="data['+r+"].column."+a.options.columnFields.editorSettings+'.itemIcon"'),e=e+(' show-icons="data['+r+"].column."+a.options.columnFields.editorSettings+'.showIcons"'),e=e+(' checkbox-settings="data['+r+"].column."+a.options.columnFields.editorSettings+'.checkBoxSettings"'),e=e+(' show-check-boxes="data['+r+"].column."+a.options.columnFields.editorSettings+'.checkBoxSettings.showCheckBoxes"');M=c(e+(' nav-selection="false" before-select="onCellValueChanging(e, '+u+", "+r+')" after-select="onCellValueChanged(e, '+u+", "+r+')"></iui-list>'))(A);vb(d,r);var f=h(function(){angular.element(pa).append(M);var c=b[0].getBoundingClientRect(),r=angular.element(C)[0].pageXOffset,u=angular.element(C)[0].pageYOffset,u=c.bottom+u-1,c=c.left+r,r=b.children().eq(0),e=k.getPadding(r[0]),r=parseInt(getComputedStyle(r[0]).width,10)+(e.left+e.right),e=k.getPadding(M[0]),r=r-(e.left+e.right);void 0!=d.dropDownWidth&&r<d.dropDownWidth&&(r=d.dropDownWidth);e=void 0!=d.dropDownHeight?d.dropDownHeight:100;void 0!=d.maxDropDownItems&&(e=Za*d.maxDropDownItems);M.css("top",u+"px");M.css("left",c+"px");M.css("width",r+"px");M.css("height",e+"px");M.css("z-index","999");B&&B[a.options.cellFields.value]&&v.selectedItem(ya,B[a.options.cellFields.value]);v.updateLayout(ya);var ub=h(function(){if(B&&B[a.options.cellFields.value]){v.ensureVisible(ya,B[a.options.cellFields.value]);var b=h(function(){v.focus(ya,B[a.options.cellFields.value]);h.cancel(b)},1);h.cancel(ub)}},10);q&&(m(!0),g(b,!0));qa=!0;wb();h.cancel(f)},1)}};a.removeDropDownList=function(a){M&&(oa=null,M.remove(),qa=!1,a||m(),M.unbind("keydown"))};var wb=function(){M.bind("keydown",function(b){switch(b.keyCode){case 27:a.removeDropDownList(),m()}})};p.bind("mousemove",function(b){if(0===b.button&&Y&&L){a.getColumnCurrentIndex(L);var c=a.getMousePos(b),d=c.y+16,c=c.x+20;aa.empty();aa.append("<span>"+L[a.options.columnFields.headerText]+"</span>");aa.css("top",d+"px");aa.css("left",c+"px");aa.css("display","block");$a();b.stopPropagation()}});var cb=function(){if(E&&0<E.length)for(var b=0;b<E.length;b++){var c=angular.element(E[b]);ab(c);for(var c=c.find("td"),d=0;d<c.length;d++){var r=angular.element(c[d]),B=a.getElement(r,"expandbox");B&&B.unbind("click");bb(r)}}},Ya=function(){var b=P.find("tr");if(0<b.length)for(var c=0;c<b.length;c++){var d=angular.element(b[c]);ab(d);for(var d=d.find("td"),r=0;r<d.length;r++){var B=angular.element(d[r]);if(B){var e=a.getChildElement(B,"column-header-cell");e&&(e=a.getContentElement(e,"filter-button"))&&e.unbind("mousedown")}(e=a.getElement(B,"expandbox"))&&e.unbind("click");bb(B)}}},Y=!1,L=null,ta=-1,Ea=function(b,c){if(b){var d=a.getColumnCurrentIndex(b),r=a.getColumnWidth(b);return a.isColumnWithFixedWidth(d)||10<c.x&&c.x<r-10}return!1},yb=function(b){b=b.find("td");for(var c=0;c<b.length;c++)currentElem=angular.element(b[c]),currentElem.bind("click",function(b){if(1===b.which){var c=k.getClientMousePos(b,this),d=a.getColumnFromElem(this);d&&Ea(d,c)&&a.callColumnClick(d,a.getMousePos(b))}b.stopPropagation()}),currentElem.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=k.getClientMousePos(b,this),d=a.getColumnFromElem(this);d&&Ea(d,c)&&a.callColumnDblClick(d,a.getMousePos(b))}b.stopPropagation()}),currentElem.bind("mouseenter",function(b){if(!V&&!Z){var c=a.getColumnFromElem(this);c&&(a.hoverColumn=c,a.refresh(c),a.callColumnHover(c));if(1===b.which&&Y&&L&&a.hoverColumn&&0!=a.hoverColumn[a.options.columnFields.allowDrop]&&O&&(O.remove(),a.hoverColumn!=L)){var d=angular.element(this);d.append(O);b=parseInt(getComputedStyle(d[0]).height,10);c=parseInt(getComputedStyle(O[0]).height,10);d=k.getPadding(d[0]);O.css("top",(b+d.top+d.bottom-c)/2+"px")}}}),currentElem.bind("mouseleave",function(b){V||Z||(a.hoverColumn=null,(b=a.getColumnFromElem(this))&&a.refresh(b),O&&O.remove(),V||p.css("cursor","default"))}),currentElem.bind("mousemove",function(b){var c=angular.element(this);if(1===b.which&&Y&&L&&a.hoverColumn&&a.hoverColumn!=L&&0!=a.hoverColumn[a.options.columnFields.allowDrop])c=parseInt(getComputedStyle(c[0]).width,10),O.empty(),ta=-1,b.offsetX>c/2?(ta=2,O.append('<span class="iui-treegrid-column-reorder-mark-right"></span>'),O.css("left","auto"),O.css("right","0")):(ta=1,O.append('<span class="iui-treegrid-column-reorder-mark-left"></span>'),O.css("left","0"),O.css("right","auto"));else{b=k.getClientMousePos(b,this);var c=a.getIndexFromElem(this),d=a.getColumnWidth(a.columnList[c]),n=10;a.isFilteringAllowed(a.columnList[c])&&(n=0);10>b.x&&0<c&&!a.isColumnWithFixedWidth(c-1)?(p.css("cursor","ew-resize"),ca="left"):b.x>d-n&&!a.isColumnWithFixedWidth(c)?(p.css("cursor","ew-resize"),ca="right"):V||(p.css("cursor","default"),ca="none")}}),currentElem.bind("mouseup",function(b){if(1===b.which&&Y&&L&&a.hoverColumn&&a.hoverColumn!=L&&0!=a.hoverColumn[a.options.columnFields.allowDrop]&&0!=a.callColumnPosChanging(L,a.hoverColumn)){b=a.columnList[0];0<=a.options.expandColIndex&&a.options.expandColIndex<a.columnList.length&&(b=a.columnList[a.options.expandColIndex]);var c=a.getColumnCurrentIndex(L),d=a.getColumnCurrentIndex(a.hoverColumn);c!=d&&(c<d?1==ta&&d--:c>d&&2==ta&&d++,a.columnsObj.moveObject(c,d),a.updateColumnList(),b=a.getColumnCurrentIndex(b),b!=a.options.expandColIndex?(a.options.expandColIndex=b,a.updateLayout()):a.updateView(),a.callColumnPosChanged(L,a.hoverColumn))}L=null;ta=-1;V=Y=!1;p.css("cursor","default")}),currentElem.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();k.getClientMousePos(b,this);var c=a.getIndexFromElem(this);if(0===b.button&&!V){switch(ca){case "left":c--;0<=c&&(V=!0);break;case "right":V=!0}!a.isColumnWithFixedWidth(c)&&V?a.setColumnResizingParams(c,ca,a.getMousePos(b).x):V=!1}if(!V&&(c=a.getColumnFromChildElem(this))){var d=k.getClientMousePos(b,this);Ea(c,d)&&a.columnSelection(c);switch(b.which){case 1:a.options.allowColumnReorder&&0!=c[a.options.columnFields.allowDrag]&&0==Y&&(L=c,a.getMousePos(b),Y=!0,(c=k.getBodyElem(p[0]))&&angular.element(c).append(aa));break;case 3:Ea(c,d)&&a.callColumnRightClick(c,a.getMousePos(b))}}b.stopPropagation()}),function(b){b&&(b=a.getChildElement(b,"column-header-cell"))&&(b=a.getContentElement(b,"filter-button"))&&b.bind("mousedown",function(a){xb(this);a.stopPropagation()})}(currentElem)},U=null,xb=function(b){a.closeFilterWindow();var d=a.getColumnFromChildElem(b);if(d){var e=angular.element(b),r=e.parent().parent();if(pa){b='<div ng-include="'+d[a.options.columnFields.filterTemplate]+'"></div>';U=angular.element('<div class="iui-filter-window"></div>');U.append(c(b)(l.$parent));var B=h(function(){angular.element(pa).append(U);U.bind("mousedown",function(a){a.stopPropagation()});e[0].getBoundingClientRect();var a=r[0].getBoundingClientRect(),b=angular.element(C)[0].pageXOffset,c=angular.element(C)[0].pageYOffset,d=h(function(){var r=a.bottom+c,n=a.right-(parseInt(getComputedStyle(U[0]).width,10)+3)+b;U.css("top",r+"px");U.css("left",n+"px");h.cancel(d)},1);h.cancel(B)},1)}}};a.closeFilterWindow=function(){U&&(U.unbind("mousedown"),U.remove())};var ab=function(a){a&&a.unbind("blur dragover dragend focus keydown keyup keypress mouseenter mouseleave")},zb=function(b){b&&(b.bind("dragover",function(b){var c=a.getRowFromElem(this);if(c&&a.isRowEnabled(c)){if(a.isScrollBarVisible("vertical")){var c=a.getMousePos(b),d=p[0].getBoundingClientRect();c.x-=angular.element(C)[0].pageXOffset;c.y-=angular.element(C)[0].pageYOffset;var n=d.top+X+25,d=d.bottom-ga-25;N&&G&&(d-=G[0].offsetHeight);c.y<n?Fa(!1):c.y>d?Fa(!0):ua()}else ua();b.stopPropagation()}}),b.bind("dragend",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&(b.preventDefault(),a.dragDropStatus(!1),a.dropMark(),f.getData().source||f.clearData())}),b.bind("mouseenter",function(b){if(!Z){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&!Y&&(a.hoverRow=c,a.refresh(c),a.callRowHover(c),a.options.hoverSelection&&(da=h(function(){da&&a.rowSelection(c,b.shiftKey,b.ctrlKey)},500)))}}),b.bind("mouseleave",function(b){Z||(a.hoverRow=null,(b=a.getRowFromElem(this))&&a.isRowEnabled(b)&&a.refresh(b),da&&(h.cancel(da),da=null))}),b.bind("keydown",function(b){var c=a.getRowFromElem(this);if(c&&a.isRowEnabled(c)){var d=!0;a.callKeyDown(b,c);var n=a.getRowCurrentIndex(c);switch(b.keyCode){case 9:db(b,c,n);break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 27:d=!1;break;case 33:eb(b,n);break;case 34:fb(b,n);break;case 35:gb(b,n);break;case 36:hb(b,n);break;case 37:ib(b,c,n);break;case 32:b.preventDefault();Pa(void 0,void 0);a.rowSelection(c,b.shiftKey,b.ctrlKey,c.selected);l.$apply();break;case 38:Qa(b,n);break;case 39:jb(b,c,n);break;case 40:Ra(b,n);break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}d&&b.stopPropagation()}}),b.bind("keyup",function(b){var c=a.getRowFromElem(this);if(c&&a.isRowEnabled(c)){switch(b.keyCode){case 16:a.multiSelection(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||a.multiSelection(!1)}a.callKeyUp(b,c)}}),b.bind("keypress",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&a.callKeyPress(b,c)}),b.bind("focus",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)?a.callGotFocus(b,c):a.updateFocus()}),b.bind("blur",function(b){var c=a.getRowFromElem(this);c&&a.isRowEnabled(c)&&a.callLostFocus(b,c)}))},Ab=function(b){b&&b.bind("click",function(b){var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&(a.toggle(c),a.updateFocus(a.getRowCurrentIndex(c),a.options.expandColIndex),b.stopPropagation())})},Bb=function(b,c,d){b&&(b.bind("dragstart",function(b){if(a.labelEditStatus())b.preventDefault();else{f.clearData();var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c))if(Q&&(h.cancel(Q),Q=null),a.isDragAllowed(c)){a.dragDropStatus(!0);a.addDropMark();b.dataTransfer?(b.dataTransfer.effectAllowed="move",b.dataTransfer.setData("text",c[a.options.rowFields.id]?c[a.options.rowFields.id].toString():"")):b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="move",b.originalEvent.dataTransfer.setData("text",c[a.options.rowFields.id]?c[a.options.rowFields.id].toString():""));b={source:c,sourceCtrl:a,sourceCollection:a.rowsObj};switch(a.options.selectionMode){case "multi-simple":b.source=a.options.selectedRows;break;case "multi-extended":b.source=a.options.selectedRows}f.setData(b)}else b.dataTransfer?b.dataTransfer.effectAllowed="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.effectAllowed="none")}}),b.bind("dragover",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=angular.element(this);b.preventDefault();var n=!0;b.dataTransfer?n="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(n="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(n&&(c=a.getRowFromChildElem(d))){var n=d[0].getBoundingClientRect(),e=angular.element(C)[0].pageXOffset,w=angular.element(C)[0].pageYOffset,u=a.getMousePos(b);u.x-=n.left+e;u.y-=n.top+w;d=f.getDropPos(u,{x:0,y:0,width:d[0].offsetWidth,height:d[0].offsetHeight});e=f.getData();n=a.isDropAllowed(e.source,c,d);w={sourceTree:e.sourceCtrl?e.sourceCtrl.getTreeName():"",dragRow:e.source,targetTree:a.getTreeName(),targetRow:c,isDropAllowed:n,dropPos:d,mousePos:a.getMousePos(b)};w=a.callDragOver(w);if(n&&!1!==w){w=a.getMousePos(b);b=w.y+16;w=w.x+20;u=a.getDropMarkWindow();u.empty();var g="iui-drop-marker-move-in";switch(d){case 1:g="iui-drop-marker-move-up";break;case 2:g="iui-drop-marker-move-down"}u.append("<span class='"+g+"'></span><span class='iui-drop-marker-title'>"+c[a.options.rowFields.text]+"</span>");a.updateDropMarkElem(a.getDropMarkWindow(),{top:b,left:w});a.dropMark(n);f.setData({source:e.source,sourceList:e.sourceList,target:c,dropPos:d})}else b.dataTransfer?b.dataTransfer.dropEffect="none":b.originalEvent&&b.originalEvent.dataTransfer&&(b.originalEvent.dataTransfer.dropEffect="none"),a.dropMark()}}}),b.bind("drop",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=angular.element(this);b.preventDefault();T&&(h.cancel(T),T=null);a.dropMark();c=!0;b.dataTransfer?c="none"===b.dataTransfer.effectAllowed?!1:!0:b.originalEvent&&b.originalEvent.dataTransfer&&(c="none"===b.originalEvent.dataTransfer.effectAllowed?!1:!0);if(c){var n=a.getRowFromChildElem(d);if(n){var d=f.getData(),e=d.source;e||(e=a.getDnDSource(b));if(c=a.isDropAllowed(e,n,d.dropPos))a.toggle(n,!0),e&&(c={sourceTree:d.sourceCtrl?d.sourceCtrl.getTreeName():"",dragRow:e,targetTree:a.getTreeName(),targetRow:n,isDropAllowed:c,dropPos:d.dropPos,mousePos:a.getMousePos(b)},!1!==a.callDragDrop(c)&&(a.drop(d),l.$$phase||l.$apply()))}}f.clearData();b.stopPropagation()}}),b.bind("dragenter",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){b.preventDefault();if(a.options.autoExpand)var d=h(function(){T||(T=h(function(){T&&a.toggle(c,!0)},750));h.cancel(d)},1);var n=f.getData();n.source||(n.source=a.getDnDSource(b));n={sourceTree:n.sourceCtrl?n.sourceCtrl.getTreeName():"",dragRow:n.source,targetTree:a.getTreeName(),targetRow:n.target,mousePos:a.getMousePos(b)};a.callDragEnter(n);b.stopPropagation()}}),b.bind("dragleave",function(b){a.hoverRow=null;var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&(b.preventDefault(),T&&(h.cancel(T),T=null),c=f.getData(),c.source||(c.source=a.getDnDSource(b)),c={sourceTree:c.sourceCtrl?c.sourceCtrl.getTreeName():"",dragRow:c.source,targetTree:a.getTreeName(),targetRow:c.target,mousePos:a.getMousePos(b)},a.callDragLeave(c),b.stopPropagation())}),b.bind("dblclick",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){b.preventDefault();if(1===b.which){var d=a.getRowCurrentIndex(c),n=parseInt(a.getIndexFromElem(this),10),e=a.getCell(d,n),f=wa(e,n),w=null,u=a.options.editorSettings;e&&(w=a.getColumnById(e[a.options.cellFields.cid]));!w&&0<=n&&n<a.columnList.length&&(w=a.columnList[n]);var g="dblclick"==a.options.editorSettings.activate;w&&w[a.options.columnFields.editorSettings]&&(u=w[a.options.columnFields.editorSettings],g=void 0!=u.activate?"dblclick"==u.activate:g);switch(f){case "checkbox":break;case "combobox":e&&0!=e[a.options.cellFields.allowEdit]&&w&&g?Oa(angular.element(this),u,d,n):a.removeDropDownList();break;default:a.removeDropDownList(),e&&0!=e[a.options.cellFields.allowEdit]&&g&&sa(b,angular.element(this),0)}0!=a.callRowDblClick(c,a.getMousePos(b))&&"checkbox"!=f&&"checkbox"!=f&&e&&!g&&(a.toggle(c),a.updateFocus(d,n))}b.stopPropagation()}}),b.bind("mouseenter",function(b){if(!Z&&(b=a.getRowFromChildElem(this))&&a.isRowEnabled(b)&&!Y){var c=a.getRowCurrentIndex(b);b=parseInt(a.getIndexFromElem(this),10);if(c=a.getCell(c,b))if((a.hoverCell=c)&&0!=c[a.options.cellFields.allowEdit])switch(wa(c,b)){case "combobox":qa||(b=angular.element(this),g(b));break;default:m()}else m()}}),b.bind("mouseleave",function(b){if(!Z&&(a.hoverCell=null,(b=a.getRowFromChildElem(this))&&a.isRowEnabled(b))){b=a.getRowCurrentIndex(b);var c=parseInt(a.getIndexFromElem(this),10);a.getCell(b,c)&&m()}}),b.bind("keydown",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=!0;a.callKeyDown(b,c);var n=a.getRowCurrentIndex(c),e=parseInt(a.getIndexFromElem(this),10),f=a.getCell(n,e),w=wa(f,e),u=null;switch(b.keyCode){case 9:db(b,c,n,e);break;case 13:switch(w){case "checkbox":Pa(f,e);break;case "combobox":f&&0!=f[a.options.cellFields.allowEdit]?(u=a.getColumnById(f[a.options.cellFields.cid]),!u&&0<=e&&e<a.columnList.length&&(u=a.columnList[e]),u&&Oa(angular.element(this),u[a.options.columnFields.editorSettings],n,e)):a.removeDropDownList();break;default:f&&0!=f[a.options.cellFields.allowEdit]&&sa(b,angular.element(this),0)}break;case 16:a.updateSelectionStatus("shift");break;case 17:a.updateSelectionStatus("ctrl");break;case 27:d=!1;break;case 33:eb(b,n,e);break;case 34:fb(b,n,e);break;case 35:gb(b,n,e);break;case 36:hb(b,n,e);break;case 37:ib(b,c,n,e);break;case 32:b.preventDefault();Pa(f,e);a.rowSelection(c,b.shiftKey,b.ctrlKey,c.selected);l.$apply();break;case 38:Qa(b,n,e);break;case 39:jb(b,c,n,e);break;case 40:Ra(b,n,e);break;default:(b.ctrlKey||b.metaKey)&&a.updateSelectionStatus("ctrl"),b.shiftKey&&a.updateSelectionStatus("shift")}d&&b.stopPropagation()}}),b.bind("keyup",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){switch(b.keyCode){case 16:a.multiSelection(!1);break;case 17:a.multiSelection(!1);break;default:b.ctrlKey||b.metaKey||a.multiSelection(!1),b.shiftKey||a.multiSelection(!1)}a.callKeyUp(b,c);b.stopPropagation()}}),b.bind("keypress",function(b){var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&(a.callKeyPress(b,c),b.stopPropagation())}),b.bind("click",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){if(1===b.which){var d=a.getRowCurrentIndex(c),n=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,n);a.callCellClick(c,d,a.getMousePos(b));a.callRowClick(c,a.getMousePos(b))}b.stopPropagation()}}),b.bind("mousedown",function(b){a.closeFilterWindow();var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){a.mouseButtonStatus(!0);switch(b.which){case 1:var d=a.getRowCurrentIndex(c),n=parseInt(a.getIndexFromElem(this),10),e=a.getCell(d,n),f=wa(e,n),w=null,u=a.options.editorSettings;e&&(w=a.getColumnById(e[a.options.cellFields.cid]));!w&&0<=n&&n<a.columnList.length&&(w=a.columnList[n]);var g="click"==a.options.editorSettings.activate;w&&w[a.options.columnFields.editorSettings]&&(u=w[a.options.columnFields.editorSettings],g=void 0!=u.activate?"click"==u.activate:g);switch(f){case "checkbox":break;case "combobox":a.rowSelection(c,b.shiftKey,b.ctrlKey);e&&0!=e[a.options.cellFields.allowEdit]&&w&&g?Oa(angular.element(this),u,d,n):a.removeDropDownList();break;default:a.rowSelection(c,b.shiftKey,b.ctrlKey),a.removeDropDownList(),e&&0!=e[a.options.cellFields.allowEdit]&&g&&sa(b,angular.element(this))}break;case 3:a.rowSelection(c,b.shiftKey,b.ctrlKey),a.callRowRightClick(c,a.getMousePos(b))}b.stopPropagation()}}),b.bind("mouseup",function(b){a.mouseButtonStatus(!1);var c=a.getRowFromChildElem(this);c&&a.isRowEnabled(c)&&a.updateSelection(c,b.shiftKey);1===b.which&&Q&&(h.cancel(Q),Q=null)}),b.bind("focus",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=a.getRowCurrentIndex(c),n=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,n);a.callGotFocus(b,c,d);if(d&&0!=d[a.options.cellFields.allowEdit])switch(wa(d,n)){case "combobox":qa||(b=angular.element(this),g(b));break;default:m()}else m()}}),b.bind("blur",function(b){var c=a.getRowFromChildElem(this);if(c&&a.isRowEnabled(c)){var d=a.getRowCurrentIndex(c),n=parseInt(a.getIndexFromElem(this),10),d=a.getCell(d,n);a.callLostFocus(b,c,d)}}))},bb=function(a){a&&a.unbind("blur click dragstart dragover drop dragenter dragleave dblclick focus keydown keypress keyup mouseenter mouseleave mousemove mousedown mouseup")};a.getFooterElem=function(){return W};a.getHeaderElem=function(){return I};a.getRowElems=function(){return E?E.find("tr"):null};var db=function(b,c,d,e){var f=a.currentList.length;0<f&&(b.shiftKey?k.isEqual(c[a.options.rowFields.id],a.currentList[0][a.options.rowFields.id])||Qa(b,d,e):k.isEqual(c[a.options.rowFields.id],a.currentList[f-1][a.options.rowFields.id])||Ra(b,d,e))},Ra=function(b,c,d){b.preventDefault();focusDelayTime=0;var e=c,f=z+ha-2,f=f<a.currentList.length-1?f:a.currentList.length-1;e==f&&J&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(p[0].clientHeight/4)}),focusDelayTime=1);if(e=a.getNextRow(e)){a.rowSelection(e,b.shiftKey,b.ctrlKey);c=a.getRowCurrentIndex(e);var g=h(function(){a.updateFocus(c,d);h.cancel(g)},focusDelayTime)}},Qa=function(b,c,d){b.preventDefault();focusDelayTime=0;var e=z;c==(0<e?e:0)&&J&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(p[0].clientHeight/4)}),focusDelayTime=1);if(e=a.getPrevRow(c)){a.rowSelection(e,b.shiftKey,b.ctrlKey);c=a.getRowCurrentIndex(e);var f=h(function(){a.updateFocus(c,d);h.cancel(f)},focusDelayTime)}},jb=function(b,c,d,e){b.preventDefault();if((void 0===e||0<=e&&e==a.options.expandColIndex)&&!a.isRowExpanded(c)&&c[a.options.rowFields.rows]&&0<c[a.options.rowFields.rows].length)a.toggle(c,!0),a.updateFocus(d,e);else if(0<=e){focusDelayTime=0;var f=e+1;b=a.columnList.length-1;f===b&&(focusDelayTime=1);if(0<=f&&f<=b)var g=h(function(){a.updateFocus(d,f);h.cancel(g)},focusDelayTime)}},ib=function(b,c,d,e){b.preventDefault();if((void 0===e||0<=e&&e==a.options.expandColIndex)&&a.isRowExpanded(c)&&c[a.options.rowFields.rows]&&0<c[a.options.rowFields.rows].length)a.toggle(c,!1),a.updateFocus(d,e);else if(0<=e){focusDelayTime=0;var f=1<e?e-1:0;if(0<=f)var g=h(function(){a.updateFocus(d,f);h.cancel(g)},focusDelayTime)}},eb=function(b,c,d){b.preventDefault();var e=c-ha,e=0<e?e:0;if(e!==c){focusDelayTime=1;var f=a.getPrevRow(e+1);if(f){a.scrollTo(f);a.rowSelection(f,b.shiftKey,b.ctrlKey);l.$apply();var g=h(function(){a.updateFocus(a.getRowCurrentIndex(f),d);h.cancel(g)},focusDelayTime)}}},fb=function(b,c,d){b.preventDefault();var e=c+ha;a.options.showHeader&&e--;a.options.showFooter&&e--;e=e<a.currentList.length-1?e:a.currentList.length-1;if(e!==c){focusDelayTime=1;var f=a.getNextRow(e-1);if(f){a.scrollTo(f,"bottom");a.rowSelection(f,b.shiftKey,b.ctrlKey);l.$apply();var g=h(function(){a.updateFocus(a.getRowCurrentIndex(f),d);h.cancel(g)},focusDelayTime)}}},gb=function(b,c,d){b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:R.y});var e=a.getLastRow();if(e){a.rowSelection(e,b.shiftKey,b.ctrlKey);var f=h(function(){a.updateFocus(a.getRowCurrentIndex(e),d);h.cancel(f)},1)}},hb=function(b,c,d){b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var e=a.getFirstRow();if(e){a.rowSelection(e,b.shiftKey,b.ctrlKey);var f=h(function(){a.updateFocus(a.getRowCurrentIndex(e),d);h.cancel(f)},1)}},Pa=function(b,c){if(b&&0!=b[a.options.cellFields.allowEdit]){var d=a.getColumnById(b[a.options.cellFields.cid]);!d&&0<=c&&c<a.columnList.length&&(d=a.columnList[c]);if(d){var e=b[a.options.cellFields.value];if((d=d[a.options.columnFields.editorSettings])&&1==d.threeState)switch(k.isString(e)||(e="unchecked"),e){case "checked":e="unchecked";break;case "indeterminate":e="checked";break;default:e="indeterminate"}else e=k.isBoolean(e)?!e:!0;b[a.options.cellFields.value]=e;l.$apply()}}},E=null,I=null,W=null,z=0,A=null,t=null,F=100,S=0,ha=0,ia=0,Aa=0,X=0,ga=0,ma=0,Ga=!1,Z=!1,Ba=9,Ca=9,Ha=0,ja=0,na=0,Da=1,Ia=0,Ja=0,ka=0,va=0,Ka=1,H=null,K=null,N=!1,J=!1;this.scrollMousePos=null;var R={x:0,y:0};l.verScrollVisibility=!1;l.$watch("verScrollVisibility",function(b,c){b!=c&&a.updateCurrentLayout()});a.getColumnWidth=function(b){var c=100;b&&b[a.options.columnFields.width]&&(c=b[a.options.columnFields.width],k.isPercent(c)?(b=p[0].clientWidth-2*a.columnList.length,J&&D&&(b-=D[0].offsetWidth),c=Math.floor(parseInt(c,10)/100*b)):k.isString&&(c=parseInt(c,10)));return c};a.updateViewSize=function(){var b=h(function(){ma=0;var c=p[0].clientWidth;J&&D&&(c-=D[0].offsetWidth);N=!1;if(0<a.columnList.length){var d=a.getHeaderElem();if(d&&(d=d.find("td"))&&0<d.length)for(var e=0;e<d.length;e++){var f=angular.element(d[e]);ma+=f[0].offsetWidth}ma>c&&(G.unbind("mousedown"),p.append(G),G.bind("mousedown",function(b){a.removeDropDownList();b=k.getClientMousePos(b,this);var c=Math.floor(p[0].clientWidth);H&&(b.x<H[0].offsetLeft?a.setScrollPos({x:a.scrollPos.x-c,y:a.scrollPos.y}):b.x>H[0].offsetLeft+H[0].offsetWidth&&a.setScrollPos({x:a.scrollPos.x+c,y:a.scrollPos.y}))}),H=angular.element(G.children().eq(0)),N=!0,H.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();1===b.which&&(y.scrollMousePos=a.getMousePos(b),Ga=!0);b.stopPropagation()}))}J=!1;l.verScrollVisibility=!1;0<a.currentList.length&&F<a.currentList.length+1&&(D.unbind("mousedown"),p.append(D),D.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();b=k.getClientMousePos(b,this);var c=Math.floor(p[0].clientHeight);K&&(b.y<K[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),Fa(!1,c)):b.y>K[0].offsetTop+K[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),Fa(!0,c)))}),K=angular.element(D.children().eq(0)),J=!0,l.verScrollVisibility=!0,K.bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow();1===b.which&&(y.scrollMousePos=a.getMousePos(b),Z=!0);b.stopPropagation()}));N||(G.unbind("mousedown"),G.remove());J||(D.unbind("mousedown"),D.remove());N&&J?p.append(ra):ra.remove();h.cancel(b);!N&&0<a.scrollPos.x&&a.setScrollPos({x:0,y:a.scrollPos.y});!J&&0<a.scrollPos.y&&a.setScrollPos({x:a.scrollPos.x,y:0})},1)};a.updateScrollView=function(){Sa()};var Sa=function(){var b=h(function(){ia=p[0].offsetWidth-2;Aa=p[0].offsetHeight-2;N&&(Aa-=G[0].offsetHeight);J&&(ia-=D[0].offsetWidth);P.css("width",ia+"px");P.css("height",Aa+"px");N&&(G.css("left","0px"),G.css("bottom","0px"),G.css("width",ia-2+"px"));J&&(D.css("top","0px"),D.css("right","0px"),D.css("height",Aa-2+"px"));N&&J&&(ra.css("left","auto"),ra.css("right","0px"));var c=h(function(){N&&ia<ma&&(ja=2,na=G[0].clientWidth-4,Ha=0,na>ja&&(Ha=na-ja),Ba=Math.floor(Ha*ia/ma),9>Ba&&(Ba=9),H.css("width",Ba+"px"),R.x=ma-ia,Da=R.x/(Ha-Ba-2));var b=a.currentList.length+1;J&&0<a.currentList.length&&F<b&&(ka=2,va=D[0].clientHeight-4,Ia=0,va>ka&&(Ia=va-ka),Ca=Math.floor(Ia*F/b),9>Ca&&(Ca=9),K.css("height",Ca+"px"),Ka=(b-F+1)/(Ia-Ca-2),R.y=Math.floor((b-F+1)*S),0>R.y&&(R.y=0),0==z?K.css("top",ka+"px"):z+F-1==a.currentList.length&&K.css("top",va-K[0].offsetHeight+"px"));h.cancel(c)},1);h.cancel(b)},5)};a.updateColumnWidth=function(){if(a.options.fillSpace){for(var b=0,c=0;c<a.columnList.length;c++)b+=a.getColumnWidth(a.columnList[c])+4;if(b<p[0].clientWidth){for(var b=(p[0].clientWidth-b)/a.columnList.length,d=0,c=0;c<a.columnList.length;c++)d=a.getColumnWidth(a.columnList[c])+b,a.columnList[c][a.options.columnFields.width]=d;return!0}}return!1};l.onCellValueChanging=function(b,c,d){c+=z;var e=a.getCell(c,d);if(e&&0==e[a.options.cellFields.allowEdit])return!1;var e=!0,f=a.getColumnObject(d),g="label",h=null;f&&(g=f[a.options.columnFields.editorType],h=f[a.options.columnFields.editorSettings]);f=null;switch(g){case "checkbox":f=h&&1==h.threeState?b.checkState:b.checked;e=a.callCellValueChanging(a.getRowObject(c),a.getCellObject(c,d),f);break;case "combobox":e=a.callCellValueChanging(a.getRowObject(c),a.getCellObject(c,d),b.item)}return e};l.onCellValueChanged=function(b,c,d){c+=z;var e=a.getColumnObject(d),f="label",g=null;e&&(f=e[a.options.columnFields.editorType],g=e[a.options.columnFields.editorSettings]);e=null;switch(f){case "checkbox":e=g&&1==g.threeState?b.checkState:b.checked;a.callCellValueChanged(a.getRowObject(c),a.getCellObject(c,d),e);break;case "combobox":if(f=a.getCell(c,d))f[a.options.cellFields.value]=b.item,l.$apply();a.removeDropDownList(!0);a.updateFocus(c,d);a.callCellValueChanged(a.getRowObject(c),a.getCellObject(c,d),b.item)}};l.onEditorClick=function(b,c,d){c+=z;var e=a.getColumnObject(d),f="label";e&&(f=e[a.options.columnFields.editorType]);switch(f){case "checkbox":a.callCellClick(a.getRowObject(c),a.getCellObject(c,d),a.getMousePos(b))}};a.setDefaultCellValue=function(b,c,d){if(void 0==b[a.options.cellFields.value]){var e=void 0;switch(c){case "checkbox":e=d&&1==d.threeState?"unchecked":!1;break;case "image":e=""}void 0!=e&&(b[a.options.cellFields.value]=e)}};var kb=function(b){for(var c='<table cellpadding="0" cellspacing="0" style="position:absolute;',c=(b?c+'bottom:0;">':c+'top:0;">')+"<tr>",d=0;d<a.columnList.length;d++)b?(c+='<td iui-class="{{data['+d+'].style.footer.general}}" data-index="'+d+'" data-element="column-footer">',c+='<div iui-class="{{data['+d+'].style.footer.cell}}" data-element="column-footer-cell"'):(c+='<td iui-class="{{data['+d+'].style.header.general}}" data-index="'+d+'" data-element="column-header">',c+='<div iui-class="{{data['+d+'].style.header.cell}}" data-element="column-header-cell"'),c+=' iui-contextmenu menu-items="data['+d+"].column."+a.options.columnFields.contextMenu+'"',b?(c+=' iui-style="overflow:hidden;width:{{data['+d+"].width}}px;text-align:{{data["+d+'].footerAlignment}}">',c+='<span iui-class="{{data['+d+'].style.footer.content}}" data-element="cell-content">',c+="{{data["+d+"].column."+a.options.columnFields.footerText+"}}</span>"):(c+=' iui-style="overflow:hidden;width:{{data['+d+"].width}}px;text-align:{{data["+d+'].headerAlignment}}">',a.columnList[d][a.options.columnFields.headerTemplate]?c+='<div ng-include="'+a.columnList[d][a.options.columnFields.headerTemplate]+'" style="margin:0;padding:0"></div>':(c+='<span iui-class="{{data['+d+'].style.header.content}}" data-element="cell-content">',c+="{{data["+d+"].column."+a.options.columnFields.headerText+"}}</span>"),c+='<span iui-class="{{data['+d+'].style.filtering}}" data-index="'+d+'" data-element="filter-button" ng-show="data['+d+'].showFiltering"></span>',c+='<span iui-class="{{data['+d+'].style.sorting}}" data-index="'+d+'" data-element="sort-button" ng-show="data['+d+'].showSorting"></span>'),c+="</div>",c+="</td>";return c+="</tr></table>"},lb=function(b,c){var d='<tr iui-class="{{data['+b+'].style}}" data-index="{{data['+b+'].index}}" tabindex="{{data['+b+'].tabindex}}"';c&&(d+=' style="position:absolute;top:-9999px"');for(var d=d+">",e=0;e<a.columnList.length;e++){var d=d+('<td iui-class="{{data['+b+"].cells["+e+'].style.cell}}" data-element="cell" data-index="'+e+'" draggable="{{data['+b+'].draggable}}" tabindex="{{data['+b+"].cells["+e+'].tabindex}}">'),d=d+('<div ng-show="data['+b+'].visible"'),d=d+(' iui-class="{{data['+b+"].cells["+e+'].style.content}}" data-element="cell-content"'),d=d+(' iui-contextmenu menu-items="data['+b+"].row."+a.options.rowFields.contextMenu+'" menu-update="{{data['+b+'].updateContextMenu}}"'),d=d+(' iui-style="width:{{data['+b+"].cells["+e+"].width}}px;text-align:{{data["+b+"].cells["+e+"].alignment}};"),d=e===a.options.expandColIndex?d+("padding-left:{{data["+b+"].cells["+e+'].indent}}px;">'):d+'">',f=b,g=e,h="";g===a.options.expandColIndex&&(h+='<span iui-class="{{data['+f+'].expandBox}}" data-element="expandbox"></span>',h+='<span iui-class="{{data['+f+'].icon}}" data-element="icon" ng-show="data['+f+'].iconVisible"></span>');var l=a.columnList[g][a.options.columnFields.editorSettings];switch(a.columnList[g][a.options.columnFields.editorType]){case "checkbox":h+='<iui-checkbox name="cb-'+k.getUniqueId(4)+'"';l&&1==l.threeState?(h+=' check-state="data['+f+"].cells["+g+"].related."+a.options.cellFields.value+'"',h+=' checkstate-changing="onCellValueChanging(e, '+f+", "+g+')"',h+=' checkstate-changed="onCellValueChanged(e, '+f+", "+g+')"',h+=' three-state="true"'):(h+=' checked="data['+f+"].cells["+g+"].related."+a.options.cellFields.value+'"',h+=' checked-changing="onCellValueChanging(e, '+f+", "+g+')"',h+=' checked-changed="onCellValueChanged(e, '+f+", "+g+')"');h+=' click="onEditorClick(e, '+f+", "+g+')"';l&&l.style&&(h+=' control-style="data['+f+"].cells["+g+'].editorStyle"');h+=' enabled="data['+f+"].cells["+g+"].related."+a.options.cellFields.enabled+'"';h+=' style="vertical-align:middle;" iui-show="{{data['+f+"].cells["+g+'].visible}}"></iui-checkbox>';break;case "combobox":h+='<span iui-class="{{data['+f+"].cells["+g+'].style.label}}" data-element="content">';h+="{{data["+f+"].cells["+g+"].related."+a.options.cellFields.value+".text}}";h+="</span>";break;case "image":h+='<img data-element="image" style="vertical-align:middle" src="{{data['+f+"].cells["+g+"].related."+a.options.cellFields.value+'}}"  iui-show="{{data['+f+"].cells["+g+'].visible}}" show-default="true" />';break;default:h+='<span iui-class="{{data['+f+"].cells["+g+'].style.label}}" data-element="content">',h+="{{data["+f+"].cells["+g+"].related."+a.options.cellFields.text+"}}",h+="</span>"}d+=h;d+="</div>";d+="</td>"}return d+"</tr>"},Cb=function(){S=0;if(0<a.currentList.length&&t){var b=lb(0,!0),d=c(b)(t);p.append(d);var e=h(function(){S=d[0].offsetHeight;d.remove();h.cancel(e)},1)}},Db=function(){var b=0,d=h(function(){Ya();Ga||Z||Sa();P.empty();W=E=I=null;A&&A.$destroy();t&&t.$destroy();0<a.columnList.length&&(A=l.$new(),A.data=mb(),a.refreshColumns(),A.$apply());h.cancel(d)},1),e=h(function(){var d="";ga=X=0;if(0<a.columnList.length){if(a.options.showHeader){d=kb();I=c(d)(A);P.append(I);X=I[0].offsetHeight;yb(I);var d=0,f=I.find("td");if(f&&0<f.length)for(var g=0;g<f.length;g++)var w=angular.element(f[g]),d=d+w[0].offsetWidth;d>p[0].clientWidth&&(d=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),d.css("bottom","-9999px"),p.append(d),b=d[0].offsetHeight,d.remove())}a.options.showFooter&&(d=kb(!0),W=c(d)(A),P.append(W),ga=W[0].offsetHeight);var k=h(function(){if(0<a.columnList.length){if(a.options.showHeader){X=I[0].offsetHeight;var d=0,e=I.find("td");if(e&&0<e.length)for(var f=0;f<e.length;f++)var g=angular.element(e[f]),d=d+g[0].offsetWidth;d>p[0].clientWidth&&(d=angular.element('<div class="iui-scrollbar-horizontal"><div class="iui-scroll-button-thumb-horizontal"></div></div>'),d.css("bottom","-9999px"),p.append(d),b=d[0].offsetHeight,d.remove())}a.options.showFooter&&(ga=W[0].offsetHeight);if(0<a.columnList.length&&0<a.currentList.length){t=l.$new();t.data=nb();a.refreshRows();t.$apply();Cb();var w=h(function(){E&&(cb(),E.remove());F=Math.floor((p[0].clientHeight-(X+ga)-b)/S)+1;ha=0;for(var d="",e=0;e<F;e++)d+=lb(e),ha++;if(0<ha){E=angular.element('<table cellpadding="0" cellspacing="0" style="position:absolute;top:'+X+'px;"></table>');E.append(c(d)(t));I?I.after(E):P.append(E);var f=h(function(){a.allowEvents=!0;if(0<a.currentList.length){cb();var b=P.find("tr");if(0<b.length){var c=null,c=0,d=b.length-1;a.options.showHeader&&c++;a.options.showFooter&&d--;for(var e=c;e<=d;e++){c=angular.element(b[e]);zb(c);for(var n=c.find("td"),g=0;g<n.length;g++){var w=angular.element(n[g]);Ab(a.getElement(w,"expandbox"));Bb(w,a.getRowFromElem(c),g)}}}}h.cancel(f)},1)}h.cancel(w)},1)}ob()}h.cancel(k)},1)}h.cancel(e)},1)};a.updateStatus=0;a.updateLayout=function(b){if(a.allowUpdate&&(a.updateStatus++,1==a.updateStatus)){a.allowEvents=!1;p.removeClass("iui-treegrid-block-rtl");a.options.rtl&&p.addClass("iui-treegrid-block-rtl");P.removeClass("iui-treegrid-block-shift-left iui-treegrid-block-rtl");P.addClass(ea());S=0;F=100;ga=X=0;a.updateColumnList();a.updateCurrentList();Db();var c=h(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();a.updateStatus--;0<a.updateStatus&&(a.updateStatus=0,a.updateLayout());h.cancel(c)},100)}};a.updateCurrentLayout=function(){if(a.allowUpdate)if(0==a.currentList.length)a.updateLayout();else{a.updateCurrentList();a.updateView();var b=h(function(){a.updateViewSize();a.updateViewSize();a.updateScrollView();h.cancel(b)},1)}};var pb=function(b,c){var d="left";return d=c?b[a.options.columnFields.footerAlignment]:b[a.options.columnFields.headerAlignment]},Eb=function(b,c){var d=pb(b),e=pb(b,!0),f=a.isFilteringAllowed(b),g=a.isSortingAllowed()&&b==a.sortColumn,h=a.getColumnWidth(b);return{headerAlignment:d,footerAlignment:e,index:c,column:b,showFiltering:f,showSorting:g,style:{header:{},footer:{}},width:0<=h?h:0}},Fb=function(b,c,d){for(var e=[],f=0;f<a.columnList.length;f++){var g,h=f;if(d){var l=a.columnList[f][a.options.columnFields.id];l&&(h=a.getCellIndexById(a.currentList[c][a.options.rowFields.cells],f,l))}g=h;if(d)a:{if(0<=g&&(h=a.currentList[c][a.options.rowFields.cells],g<h.length)){h=h[g];break a}h={}}else h={};var l=a.columnList[f][a.options.columnFields.contentAlignment]?a.columnList[f][a.options.columnFields.contentAlignment]:"left",m;m=(m=a.columnList[f][a.options.columnFields.editorSettings])&&m.style?m.style:null;var p;if(d){if(p=0,f==a.options.expandColIndex){p=c;var q=0,t=a.columnList[a.options.expandColIndex],x=a.getColumnWidth(t),v=x-a.indentList[p],v=0<=v?v:0,q={top:0,right:0,bottom:0,left:0};(t=a.getElemFromColumn(t))&&(t=a.getChildElement(t,"column-header-cell"))&&(q=k.getPadding(t[0]));q=q.left+a.indentList[p];0==v&&(q=x);p=q}}else p=0;x=g;d?(v=c,q=f,v=1==a.options.allowFocus&&1==a.options.allowCellFocus&&a.isRowEnabled(a.currentList[v])&&0<=q?a.getTabIndex().toString()+(v+1).toString()+q.toString():""):v="";if(d)a:{if(0<=g&&(q=a.currentList[c][a.options.rowFields.cells],g<q.length)){q=q[g][a.options.cellFields.text];break a}q=""}else q="";if(d)a:{if(0<=g&&(t=a.currentList[c][a.options.rowFields.cells],g<t.length)){t=t[g][a.options.cellFields.value];break a}t=null}else t=null;g=d?0<=g?!0:!1:!1;var y;if(d){y=c;var A=f,z=a.getColumnWidth(a.columnList[A]);A==a.options.expandColIndex&&(z-=a.indentList[y]);y=z=0<=z?z:0}else y=0;e.push({related:h,alignment:l,editorStyle:m,indent:p,index:x,style:{},tabindex:v,text:q,value:t,visible:g,width:y})}if(d){f="";h=a.defaultStyle.row.expandBox.general;a.options.controlStyle.row.expandBox.general!=h&&(h+=" "+a.options.controlStyle.row.expandBox.general);l=a.getCurrentRowStyle(b);l=a.getExpandBoxStyle(l.expandBox);if(a.isThereChildRows||b&&b[a.options.rowFields.hasChildren])f=h;b&&(b[a.options.rowFields.hasChildren]||b[a.options.rowFields.rows]&&0<b[a.options.rowFields.rows].length&&a.isThereVisibleChildren(b))&&(a.options.loadRow&&k.isEqual(b[a.options.rowFields.id],a.options.loadRow[a.options.rowFields.id])?f+=" "+l.animated:(f=b[a.options.rowFields.hasChildren]&&void 0===b[a.options.rowFields.expanded]?f+(" "+l.expanded):!1!==b[a.options.rowFields.expanded]?f+(" "+l.collapsed):f+(" "+l.expanded),!0===a.options.rtl&&(f+="-rtl"),a.isRowEnabled(b)||(f+="-disabled")))}else f="";h=d?a.isRowEnabled(b)&&a.isDragAllowed(b):!1;d?(l="",b.icon?l=b.icon:a.options.rowIcon&&(l=a.options.rowIcon)):l="";m=d?0!=a.options.showIcons&&(b.icon||a.options.rowIcon):!1;g=d?1==a.options.allowFocus&&0==a.options.allowCellFocus&&a.isRowEnabled(a.currentList[c])?a.getTabIndex().toString()+(c+1).toString():"":"";return{cells:e,expandBox:f,draggable:h,icon:l,iconVisible:m,index:c,row:d?b:{},style:{},tabindex:g,updateContextMenu:d?null!=b[a.options.rowFields.contextMenu]:!1,visible:d}},mb=function(){for(var b=[],c=0;c<a.columnList.length;c++)b.push(Eb(a.columnList[c],c));return b},nb=function(){for(var b=[],c=z;c<z+F;c++)b.push(Fb(a.currentList[c],c,c<a.currentList.length));return b},ob=function(){for(var b=0;b<a.columnList.length;b++)if(a.isFilteringAllowed(a.columnList[b])){var c=a.getElemFromColumn(a.columnList[b]);c&&(c=a.getChildElement(c,"column-header-cell"))&&(c=a.getContentElement(c,"filter-button"))&&(c.css("top",(X-parseInt(getComputedStyle(c[0]).height,10))/2-1+"px"),c.css("right","2px"))}a.isSortingAllowed()&&a.sortColumn&&(b=a.getElemFromColumn(a.sortColumn))&&(c=a.getChildElement(b,"column-header-cell"))&&(c=a.getContentElement(c,"sort-button"))&&(c.css("top",(X-parseInt(getComputedStyle(c[0]).height,10))/2-1+"px"),a.isFilteringAllowed(a.sortColumn)?c.css("right","22px"):c.css("right","2px"))};a.getRowScope=function(){return t};a.updateView=function(){var b=h(function(){t&&(a.allowEvents=!1,qb(!1),0<a.columnList.length&&(A.data=mb(),t.data=nb(),a.refresh(null,null,!1),A.$apply(),t.$apply(),ob(),a.allowEvents=!0));h.cancel(b)},1)};var rb=function(b,c,d){var e={cell:"",content:"",general:"",label:""},f="";switch(c){case "column":d?(f=a.defaultStyle.column.footer.normal,a.options.controlStyle.column.footer.normal!=f&&(f+=" "+a.options.controlStyle.column.footer.normal),e.general=f,e.cell="iui-treegrid-column-footer-cell",f=a.defaultStyle.column.footer.content,a.options.controlStyle.column.footer.content!=f&&(f+=" "+a.options.controlStyle.column.footer.content)):(f=a.defaultStyle.column.header.normal,a.options.controlStyle.column.header.normal!=f&&(f+=" "+a.options.controlStyle.column.header.normal),e.general=f,e.cell="iui-treegrid-column-header-cell",f=a.defaultStyle.column.header.content,a.options.controlStyle.column.header.content!=f&&(f+=" "+a.options.controlStyle.column.header.content));e.content=f;break;case "row":f=a.defaultStyle.row.general.normal;a.options.controlStyle.row.general.normal!=f&&(f+=" "+a.options.controlStyle.row.general.normal);e.general=f;break;case "cell":f=a.defaultStyle.row.cell.normal;a.options.controlStyle.row.cell.normal!=f&&(f+=" "+a.options.controlStyle.row.cell.normal);switch(a.options.gridLines){case "none":f=b==z+F-1||b==a.currentList.length-1?f+" iui-treegrid-lines-horizontal":f+" iui-treegrid-lines-none";break;case "horizontal":f+=" iui-treegrid-lines-horizontal";break;case "vertical":f=b==z+F-1||b==a.currentList.length-1?f+" iui-treegrid-lines-both":f+" iui-treegrid-lines-vertical";break;default:f+=" iui-treegrid-lines-both"}e.general=f;f=a.defaultStyle.row.cell.content;a.options.controlStyle.row.cell.content!=f&&(f+=" "+a.options.controlStyle.row.cell.content);e.content=f;e.label=a.getDefaultCellLabelClass()}return e},La=function(b,c,d,e){var f=a.getObjState(b);d=rb(d,b.type,e);switch(b.type){case "column":e?(c=a.getCurrentColumnStyle(b,"footer",f),c!=a.options.controlStyle.column.footer.normal&&(d.general+=" "+c),b=a.getCurrentColumnStyle(b,"footer","content"),b!=a.options.controlStyle.column.footer.content&&(d.content+=" "+b)):(c=a.getCurrentColumnStyle(b,"header",f),c!=a.options.controlStyle.column.header.normal&&(d.general+=" "+c),b=a.getCurrentColumnStyle(b,"header","content"),b!=a.options.controlStyle.column.header.content&&(d.content+=" "+b));break;case "row":b=a.getCurrentRowStyle(b,f);b!=a.options.controlStyle.row.general.normal&&(d.general+=" "+b);break;case "cell":e=a.getCurrentCellStyle(c,b,f),e!=a.options.controlStyle.row.cell.normal&&(d.general+=" "+e),b=a.getCurrentCellStyle(c,b,"content"),b!=a.options.controlStyle.row.cell.content&&(d.content+=" "+b)}return d},Ta=function(a,b,c){t.data[a].cells[b].style.cell=c.general;t.data[a].cells[b].style.content=c.content;t.data[a].cells[b].style.label=c.label},sb=function(b){if(t&&(b-=z,0<=b&&b<t.data.length)){t.data[b].style=a.defaultStyle.row.general.normal;for(var c=0;c<a.columnList.length;c++)t.data[b].cells[c].style.cell=a.defaultStyle.row.cell.normal+" iui-treegrid-cell-empty"}};a.refreshColumns=function(){for(var b=0;b<a.columnList.length;b++)a.refresh(a.columnList[b],null,!1)};a.refreshRows=function(){for(var b=z;b<z+F;b++)b<a.currentList.length?a.refresh(a.currentList[b],null,!1):sb(b)};a.refresh=function(b,c,d){if(b)switch(b.type){case "column":if(A&&(c=a.getColumnCurrentIndex(b),0<=c&&c<A.data.length)){1==a.options.showHeader&&(A.data[c].style.header=La(b));1==a.options.showFooter&&(A.data[c].style.footer=La(b,null,-1,!0));var e=A.data[c].style,f="";if(a.isFilteringAllowed(b)){var g=a.getObjState(b),f="iui-filtering";"selected"==g?f+=" iui-filtering-selected":"hovered"==g&&(f+=" iui-filtering-hovered")}e.filtering=f;c=A.data[c].style;e="";a.isSortingAllowed()&&b==a.sortColumn&&(b=a.getObjState(b),"ascending"==a.options.sorting?(e="iui-sort-ascending","selected"==b?e+=" iui-sort-ascending-selected":"hovered"==b&&(e+=" iui-sort-ascending-hovered")):(e="iui-sort-descending","selected"==b?e+=" iui-sort-descending-selected":"hovered"==b&&(e+=" iui-sort-descending-hovered")));c.sorting=e;void 0==d&&A&&A.$apply()}break;case "row":if(t&&(c=a.getRowCurrentIndex(b),e=c-z,0<=e&&e<t.data.length)){t.data[e].style=La(b).general;f=rb(c,"cell");for(g=0;g<a.columnList.length&&g<t.data[e].cells.length;g++){var h=t.data[e].cells[g].index;if(0<=h){var k=b[a.options.rowFields.cells];h<k.length?(h=La(k[h],b,c),Ta(e,g,h)):Ta(e,g,f)}else Ta(e,g,f)}void 0==d&&t&&t.$apply()}}else{for(g=0;g<a.columnList.length;g++)a.refresh(a.columnList[g],null,!1);for(b=z;b<z+F;b++)b<a.currentList.length?a.refresh(a.currentList[b],null,!1):sb(b);1==d&&t&&t.$apply()}};var ca="none",V=!1,Ma=-1,ca="none",Ua=0,Va=0;l.$watch(function(){return p[0].offsetWidth},function(b,c){b!=c&&a.updateCurrentLayout()});l.$watch(function(){return p[0].offsetHeight},function(b,c){b!=c&&a.updateCurrentLayout()});a.isColumnWithFixedWidth=function(b){var c=a.columnList;return c&&0<=b&&b<c.length?c[b][a.options.columnFields.fixedWidth]?c[b][a.options.columnFields.fixedWidth]:!1:!1};a.setColumnResizingParams=function(b,c,d){0<=b&&b<a.columnList.length&&(Ma=b,ca=c,Va=d,Ua=a.getColumnWidth(a.columnList[b]))};a.resizeColumn=function(b,c){0>c&&(c=0);var d=null;I&&(d=angular.element(I.find("tr")),a.resizeColumnCells(d,b,c));if(E){var d={top:0,right:0,bottom:0,left:0},e=a.getElemFromColumn(a.columnList[b]);e&&(e=a.getChildElement(e,"column-header-cell"))&&(d=k.getPadding(e[0]));for(var e=E.find("tr"),f=0;f<e.length;f++)angular.element(e[f]),a.resizeColumnCells(angular.element(e[f]),b,c,!0,d)}W&&(d=angular.element(W.find("tr")),a.resizeColumnCells(d,b,c));0<=b&&b<a.columnList.length&&a.callColumnSizeChanged(a.columnList[b])};a.resizeColumnCells=function(b,c,d,e,f){if(b){var g=-1;e&&(g=a.getRowCurrentIndex(a.getRowFromElem(b)));e=e=0;0<=g&&(e=a.indentList[g]);b=b.find("td");0<=c&&c<b.length&&(b=angular.element(b[c]),0<b.children().length&&(b=b.children().eq(0)))&&(e=a.options.rtl?f?f.right+e:e:f?f.left+e:e,f=d,0<=g&&c==a.options.expandColIndex&&(f-=e),f=0<=f?f:0,b.css("width",f+"px"),c==a.options.expandColIndex&&(a.options.rtl?0==f?b.css("padding-right",d+"px"):b.css("padding-right",e+"px"):0==f?b.css("padding-left",d+"px"):b.css("padding-left",e+"px")))}};angular.element(C).bind("dragover",function(a){ua()});var O=angular.element('<div class="iui-treegrid-column-reorder-mark"><span></span></div>'),aa=angular.element('<div class="iui-treegrid-column-reorder-tooltip"><span></span></div>'),$a=function(b){var c="initial";Y&&L&&(!a.hoverColumn||L==a.hoverColumn||a.hoverColumn&&0==a.hoverColumn.allowDrop)&&(c="not-allowed",b&&aa&&aa.css("display","none"));p.css("cursor",c);document.body.style.cursor=c};angular.element(C).bind("mousemove",function(b){if(0===b.button&&0<=Ma&&"none"!=ca){var c=a.getMousePos(b),d=Ma,c=Ua+c.x-Va,c=0<=c?c:0,e=a.columnList;0<=d&&d<e.length&&(e[d][a.options.columnFields.width]=c,a.resizeColumn(d,c),a.updateViewSize(),Sa())}Ga?1===b.which&&(H[0].getBoundingClientRect(),b=a.getMousePos(b),y.scrollMousePos||(y.scrollMousePos=b),d=H[0].offsetLeft+(b.x-y.scrollMousePos.x),d<ja?d=ja:d+H[0].offsetWidth>na&&(d=na-H[0].offsetWidth),H.css("left",d+"px"),y.scrollMousePos=b,a.scrollPos.x=!1!==a.options.rtl?parseInt((na-H[0].offsetLeft-H[0].offsetWidth)*Da,10):parseInt((H[0].offsetLeft-ja)*Da,10),tb(),a.callScrollPosChanged()):Z&&1===b.which&&(K[0].getBoundingClientRect(),b=a.getMousePos(b),y.scrollMousePos||(y.scrollMousePos=b),d=K[0].offsetTop+(b.y-y.scrollMousePos.y),d<ka?d=ka:d+K[0].offsetHeight>va&&(d=va-K[0].offsetHeight),K.css("top",d+"px"),y.scrollMousePos=b,Ja=d-ka,a.scrollPos.y=Math.floor(Ja*Ka*S),newIndex=0<S?Math.floor(a.scrollPos.y/S):0,newIndex+F-1>a.currentList.length&&(newIndex=a.currentList.length-F+1,newIndex+=5),0>newIndex&&(newIndex=0),newIndex!==z&&(z=newIndex,a.updateView()),a.callScrollPosChanged())});angular.element(C).bind("mousedown",function(b){a.removeDropDownList();a.closeFilterWindow()});angular.element(C).bind("mouseup",function(b){$a(!0);aa&&aa.remove();Y=!1;Ma=-1;ca="none";Va=Ua=0;V=!1;p.css("cursor","default");a.dropMark();Z&&a.updateView();ua();y.scrollMousePos=null;Z=Ga=!1;p.css("cursor","default")});var Wa=!1,la=0,Na=null,Xa=.5;a.isScrollBarVisible=function(a){switch(a){case "horizontal":return N;case "vertical":return J}return N&&J};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){if(b){0>b.x&&(b.x=0);b.x>R.x&&(b.x=R.x);0>b.y&&(b.y=0);b.y>R.y&&(b.y=R.y);a.scrollPos=b;Ja=Math.floor(a.scrollPos.y/(S*Ka));b=0;var c=ka+Ja;b=!1!==a.options.rtl?Math.floor(a.scrollPos.x/Da)-(na-H[0].offsetWidth-ja):Math.floor(a.scrollPos.x/Da)+ja;N&&H&&H.css("left",b+"px");J&&K&&K.css("top",c+"px");tb();qb();a.callScrollPosChanged()}};var Fa=function(b,c,d){Wa||(a.updateFocus(),la=0,Wa=!0,Na=e(function(){var d=c,e=a.getScrollPos();d||(0===la&&(la=5),la+=5+Ka,Xa+=.5,d=la+=Math.floor(Xa));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&ua()},d?d:100))},ua=function(){Na&&(e.cancel(Na),Na=null);Wa=!1;la=0};a.cancelScrollTimer=function(){ua()};a.scrollTo=function(b,c){if(b){var d=a.getRowCurrentIndex(b);if(a.isRowIndexInRange(d)){var e=0,e=d;switch(c){case "center":e=Math.floor(ha/2)-1;e=d>e?d-e:0;break;case "bottom":e=ha-2,a.options.showHeader&&e--,a.options.showFooter&&e--,e=d>e?d-e:0}a.setScrollPos({x:a.scrollPos.x,y:e*S})}}};var tb=function(){var b=a.scrollPos.x;0>b&&(b=0);b>R.x&&(b=R.x);b*=-1;!1!==a.options.rtl?(I&&I.css("right",b+"px"),W&&W.css("right",b+"px"),E&&E.css("right",b+"px")):(I&&I.css("left",b+"px"),W&&W.css("left",b+"px"),E&&E.css("left",b+"px"))},qb=function(b){if(!(0==b&&0>=S)){newIndex=0<S?Math.floor(a.scrollPos.y/S):0;a.scrollPos.y==R.y&&newIndex--;if(a.currentList.length>=F&&newIndex+F-1>a.currentList.length){newIndex=a.currentList.length-F+1;var c=a.getRowElems();c&&0<c.length&&(c=angular.element(c[c.length-1]),c[0].offsetTop+c[0].offsetHeight>p[0].clientHeight-(X+ga)&&newIndex++)}0>newIndex&&(newIndex=0);newIndex!=z&&(z=newIndex,0!=b&&a.updateView(!0))}};p.bind("scroll",function(a){p[0].scrollTop=0;p[0].scrollLeft=0});p.bind("mousewheel",function(b){b.preventDefault();if(J){a.updateFocus();var c=a.hoverRow;a.hoverRow=null;a.refresh(c);c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(p[0].clientHeight/4)*c*-1})}});y=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(y.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",p[0].scrollTop+"px"),this.$tw.css("left",p[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",p[0].scrollTop+"px"),this.$tw.css("left",p[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=h(function(){y.trActive||(y.trCount=0,y.trActive=!0,y.trId=e(function(){y.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(e.clear(this.trId),this.trId=null);this.trlTime&&(h.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};p.append(this.$tw);this.s1t(this.twp);angular.isDefined(l.options)?(a.options=l.options,a.updateData()):(0==l.allowAnimation&&(a.options.allowAnimation=l.allowAnimation),0==l.allowCellFocus&&(a.options.allowCellFocus=l.allowCellFocus),1==l.allowColumnReorder&&(a.options.allowColumnReorder=l.allowColumnReorder),angular.isDefined(l.controlStyle)&&a.updateControlStyle(l.controlStyle),1==l.allowDrag&&(a.options.allowDrag=l.allowDrag),0==l.allowDrop&&(a.options.allowDrop=l.allowDrop),1==l.allowFilter&&(a.options.allowFilter=l.allowFilter),0==l.allowFocus&&(a.options.allowFocus=l.allowFocus),0==l.autoExpand&&(a.options.autoExpand=l.autoExpand),angular.isDefined(l.animationSpeed)&&200!==l.animationSpeed&&(a.options.animationSpeed=l.animationSpeed),angular.isDefined(l.editorSettings)&&a.updateEditorSettings(l.editorSettings),angular.isDefined(l.expandingColumnIndex)&&(a.options.expandColIndex=l.expandingColumnIndex),angular.isDefined(l.fields)&&(a.updateDataFields(l.fields),a.updateData()),1==l.fillSpace&&(a.options.fillSpace=l.fillSpace),angular.isDefined(l.gridLines)&&(a.options.gridLines=l.gridLines),1==l.hoverSelection&&(a.options.hoverSelection=l.hoverSelection),angular.isDefined(l.rowIcon)&&(a.options.rowIcon=l.rowIcon),angular.isDefined(l.labelEdit)&&(a.options.labelEdit=l.labelEdit),1==l.rtl&&(a.options.rtl=l.rtl),angular.isDefined(l.selectedIndex)&&(a.options.selectedIndex=l.selectedIndex),angular.isDefined(l.selectedRow)&&(a.options.selectedRow=l.selectedRow),angular.isDefined(l.selectionMode)&&(a.options.selectionMode=l.selectionMode),0==l.showFooter&&(a.options.showFooter=l.showFooter),0==l.showHeader&&(a.options.showHeader=l.showHeader),0==l.showIcons&&(a.options.showIcons=l.showIcons),angular.isDefined(l.sorting)&&(a.options.sorting=l.sorting));a.updateLayout()}}}]);
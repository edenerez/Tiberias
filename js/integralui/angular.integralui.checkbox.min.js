/*
  filename: angular.integralui.checkbox.min.js
  version : 1.1.0
  Copyright © 2014-2015 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUICheckBoxService",["$rootScope","IntegralUIPublicService",function(b,m){return{refresh:function(d){b.$broadcast(d+"-refresh")},resumeLayout:function(d){b.$broadcast(d+"-resume-layout")},suspendLayout:function(d){b.$broadcast(d+"-suspend-layout")},updateLayout:function(d){b.$broadcast(d+"-update-layout")}}}]).controller("IntegralUICheckBoxController",["$scope","$element","IntegralUIInternalService",function(b,m,d){var c=this;c.defaultStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"},content:{general:"iui-checkbox-content",disabled:"iui-checkbox-content-disabled"}};c.options={autoCheck:!0,checked:!1,checkState:"unchecked",controlStyle:c.defaultStyle,enabled:!0,rtl:!1,text:"",threeState:!1};this.updateOptions=function(a){c.options={autoCheck:d.isFieldAvailable(a.autoCheck,!1),checked:d.isFieldAvailable(a.checked,!1),checkState:d.isFieldAvailable(a.checkState,"unchecked"),controlStyle:d.isFieldAvailable(a.controlStyle,null),rtl:d.isFieldAvailable(a.rtl,!1),text:d.isFieldAvailable(a.text,""),threeState:d.isFieldAvailable(a.threeState,!1)}};this.getCheckValue=function(a){return"checked"==a?"checked":1==c.options.threeState&&"indeterminate"==a?"indeterminate":"unchecked"};this.setCheckValue=function(a){var e=!1,e=1==c.options.threeState?c.callCheckStateChanging(a):c.callCheckedChanging(a);!1!==e&&(c.options.checkState="unchecked"==a?1==c.options.threeState?"indeterminate":"checked":"indeterminate"==a?"checked":"unchecked",c.options.checked="checked"==c.options.checkState?!0:!1,angular.isDefined(b.checked)&&(b.checked=c.options.checked),angular.isDefined(b.checkState)&&(b.checkState=c.options.checkState),angular.isDefined(b.checkState)||1!=c.options.threeState?angular.isDefined(b.checked)||0!=c.options.threeState||c.callCheckedChanged(c.options.checkState):c.callCheckStateChanged(c.options.checkState))};this.callCheckedChanging=function(a){var e=!0;a=c.getCheckValue(a);e="checked"==a?!0:!1;return e=angular.isDefined(b.events)&&b.events.checkedChanging?b.events.checkedChanging({checked:e,checkState:a}):b.checkedChanging({e:{checked:e,checkState:a}})};this.callCheckedChanged=function(a){a=c.getCheckValue(a);var e="checked"==a?!0:!1;angular.isDefined(b.events)&&b.events.checkedChanged?b.events.checkedChanged({checked:e,checkState:a}):b.checkedChanged({e:{checked:e,checkState:a}})};this.callCheckStateChanging=function(a){var e=!0;a=c.getCheckValue(a);e="checked"==a?!0:!1;return e=angular.isDefined(b.events)&&b.events.checkstateChanging?b.events.checkstateChanging({checked:e,checkState:a}):b.checkstateChanging({e:{checked:e,checkState:a}})};this.callCheckStateChanged=function(a){a=c.getCheckValue(a);var e="checked"==a?!0:!1;angular.isDefined(b.events)&&b.events.checkstateChanged?b.events.checkstateChanged({checked:e,checkState:a}):b.checkstateChanged({e:{checked:e,checkState:a}})};this.callClick=function(a){a=c.getCheckValue(a);var e="checked"==a?!0:!1;angular.isDefined(b.events)&&b.events.click?b.events.click({checked:e,checkState:a}):b.click({e:{checked:e,checkState:a}})};this.callEnabledChanged=function(a){angular.isDefined(b.events)&&b.events.enabledChanged?b.events.enabledChanged({enabled:a}):b.enabledChanged({e:{enabled:a}})};this.callStyleChanged=function(a){angular.isDefined(b.events)&&b.events.styledChanged?b.events.styleChanged({style:a}):b.styleChanged({e:{style:a}})};c.allowUpdate=!0;this.suspendLayout=function(){c.allowUpdate=!1};this.resumeLayout=function(){c.allowUpdate=!0;c.updateLayout()};b.$on(b.name+"-refresh",function(a){c.refresh()});b.$on(b.name+"-resume-layout",function(a){c.resumeLayout()});b.$on(b.name+"-suspend-layout",function(a){c.suspendLayout()});b.$on(b.name+"-update-layout",function(a){c.updateLayout()});b.$watch("autoCheck",function(a,b){a!==b&&(c.options.autoCheck=a)});b.$watch("checked",function(a,b){a!==b&&(c.options.checked=0!=a?!0:!1,c.options.checkState=c.options.checked?"checked":"unchecked",c.updateCheckMark(),c.callCheckedChanged(c.options.checkState))});b.$watch("checkState",function(a,b){a!==b&&(c.options.checkState=c.getCheckValue(a),c.options.checked="unchecked"==c.options.checkState?!1:!0,c.updateCheckMark(),c.callCheckStateChanged(c.options.checkState))});b.$watch("controlStyle",function(a,b){a!==b&&(c.options.controlStyle=a,c.refresh(),c.callStyleChanged(a))});b.$watch("enabled",function(a,b){a!==b&&(c.options.enabled=a,c.refresh(),c.callEnabledChanged(a))});b.$watch("rtl",function(a,b){a!==b&&(c.options.rtl=a,c.updateLayout())});b.$watch("text",function(a,b){a!==b&&(c.options.text=a)});b.$watch("threeState",function(a,b){a!==b&&(c.options.threeState=a,0==c.options.threeState&&"indeterminate"==c.options.checkState&&c.setCheckValue("checked"))});var g=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-checkbox-box"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-disabled"),checked:d.isFieldAvailable(a.checked,"iui-checkbox-checked"),indeterminate:d.isFieldAvailable(a.indeterminate,"iui-checkbox-indeterminate"),unchecked:d.isFieldAvailable(a.unchecked,"iui-checkbox-unchecked")}:c.defaultStyle.box},n=function(a){return a?{general:d.isFieldAvailable(a.general,"iui-checkbox-content"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-content-disabled")}:c.defaultStyle.content};this.updateControlStyle=function(a){c.options.controlStyle=a?{general:d.isFieldAvailable(a.general,"iui-checkbox"),box:g(a.box),content:n(a.content)}:{general:d.isFieldAvailable(c.defaultStyle.general,"iui-checkbox"),box:g(c.defaultStyle.box),content:n(c.defaultStyle.content)}}}]).directive("iuiCheckbox",["$timeout","$interval","IntegralUIInternalService",function(b,m,d){return{restrict:"EA",controller:"IntegralUICheckBoxController",transclude:!0,replace:!0,template:'<div data-element="checkbox"><canvas></canvas><div ng-transclude></div></div>',scope:{autoCheck:"=",checked:"=",checkState:"=",controlStyle:"=",enabled:"=",name:"@",options:"=?",rtl:"=",text:"@",threeState:"=",checkedChanging:"&",checkedChanged:"&",checkstateChanging:"&",checkstateChanged:"&",click:"&",enabledChanged:"&",styleChanged:"&",events:"=?"},link:function(c,g,n,a,e){var h=this,f=g.children().eq(0),k=g.children().eq(1);c.$on("destroy",function(a){h.cb_s2t();g.unbind("click");f.unbind("click mouseup")});var q=function(){f.bind("click",function(c){0!=a.options.enabled&&(a.setCheckValue(a.options.checkState),a.callClick(a.options.checkState),a.updateLayout());c.stopPropagation()});f.bind("mouseup",function(a){a.stopPropagation()})};g.bind("click",function(c){0!=a.options.enabled&&a.options.autoCheck&&(a.setCheckValue(a.options.checkState),a.updateLayout())});a.updateCheckMark=function(){if(f){var c=getComputedStyle(f[0])["background-image"];if(c&&"none"!=c)l();else if("CANVAS"==f[0].tagName){l();getComputedStyle(f[0]);var c=getComputedStyle(f[0]).color,b=f[0].getContext("2d"),d=f[0].width,e=f[0].height;b.beginPath();b.rect(0,0,d,e);b.fillStyle="#ffffff";b.fill();"checked"==a.options.checkState?(b.lineWidth=12<e?3:1,b.strokeStyle=c,"indeterminate"==a.options.checkState&&(b.strokeStyle="#808080"),b.beginPath(),b.moveTo(3,e/2+1),b.lineTo(0+d/2,0+e-3),b.stroke(),b.beginPath(),b.moveTo(0+d/2-1,0+e-3),b.lineTo(0+d-3,3),b.stroke()):"indeterminate"==a.options.checkState&&(b.beginPath(),b.rect(4,4,d-8,e-8),b.fillStyle=c,b.fill())}}};a.updateLayout=function(){if(a.allowUpdate){f.unbind("click mouseup");a.refresh();var c=b(function(){var d="ltr";!0===a.options.rtl&&(d="rtl");g.css("direction",d);if((d=getComputedStyle(f[0])["background-image"])&&"none"!=d)f.remove(),f=angular.element("<span></span>"),g.prepend(f),l();else{f.remove();f=angular.element("<canvas></canvas>");g.prepend(f);l();var d=getComputedStyle(f[0]).width,e=getComputedStyle(f[0]).height;f[0].width=d?parseInt(d,10):14;f[0].height=e?parseInt(e,10):14;!0===a.options.rtl?(f.css("left","auto"),f.css("right",0)):(f.css("left",0),f.css("right","auto"));a.updateCheckMark()}0==k.children().length&&k.css("padding",0);q();b.cancel(c)},1)}};var l=function(){var b=a.defaultStyle.box.general+" "+a.defaultStyle.box[a.options.checkState];a.options.controlStyle&&a.options.controlStyle.box&&(a.options.controlStyle.box.general&&d.isString(a.options.controlStyle.box.general)&&(b+=" "+a.options.controlStyle.box.general),0==a.options.enabled&&a.options.controlStyle.box.disabled&&d.isString(a.options.controlStyle.box.disabled)?b+=" "+a.options.controlStyle.box.disabled:a.options.controlStyle.box[a.options.checkState]&&d.isString(a.options.controlStyle.box[a.options.checkState])&&(b+=" "+a.options.controlStyle.box[a.options.checkState]));f.removeAttr("class");f.addClass(b)};a.refresh=function(){g.removeAttr("class");g.addClass(a.defaultStyle.general);a.options.controlStyle&&d.isString(a.options.controlStyle.general)&&g.addClass(a.options.controlStyle.general);0<f.length&&l();0<k.length&&(k.removeAttr("class"),k.addClass(a.defaultStyle.content.general),a.options.controlStyle&&a.options.controlStyle.content&&d.isString(a.options.controlStyle.content.general)&&k.addClass(a.options.controlStyle.content.general),0==a.options.enabled&&a.options.controlStyle.content.disabled&&d.isString(a.options.controlStyle.content.disabled)&&k.addClass(a.options.controlStyle.content.disabled))};this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var b;b="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";b+=a[1]+a[4]+a[2]+a[0]+a[3];return b+="</div>"};this.cb_tpar=this.crpar();this.$cb_tw=angular.element(this.crtr(this.cb_tpar));this.tmp=300;this.cb_twp=200*h.tmp;this.cb_trActive=!1;this.cb_trCount=0;this.cb_trlTime=this.cb_trId=null;this.cb_trShowCount=0;this.cb_animTr=function(){this.cb_trCount++;3>this.cb_trShowCount?(this.cb_trCount=1,this.$cb_tw.css("display","block"),this.$cb_tw.css("top",g[0].scrollTop+"px"),this.$cb_tw.css("left",g[0].scrollLeft+"px"),this.cb_trShowCount++):(0===this.cb_trCount%49&&(this.cb_trShowCount=0),this.$cb_tw.css("display","none"),this.$cb_tw.css("top",g[0].scrollTop+"px"),this.$cb_tw.css("left",g[0].scrollLeft+"px"))};this.cb_s1t=function(a){this.cb_trlTime=b(function(){h.cb_trActive||(h.cb_trCount=0,h.cb_trActive=!0,h.cb_trId=m(function(){h.cb_animTr()},1E3))},a)};this.cb_s2t=function(){this.cb_trId&&(m.clear(this.cb_trId),this.cb_trId=null);this.cb_trlTime&&(b.cancel(this.cb_trlTime),this.cb_trlTime=null);this.cb_trActive=!1;this.$cb_tw.remove()};var p=!1,r=b(function(){for(var a=g.parent();a&&a[0]&&a[0]!==document.getElementsByTagName("body")[0];){if(a[0].attributes&&a[0].attributes["data-element"]&&("list"==a[0].attributes["data-element"].value||"treeview"==a[0].attributes["data-element"].value||"treegrid"==a[0].attributes["data-element"].value)){p=!0;break}a=a.parent()}p||(g.append(h.$cb_tw),h.cb_s1t(h.cb_twp));b.cancel(r)},1);angular.isDefined(c.options)?a.updateOptions(c.options):(0==c.autoCheck&&(a.options.autoCheck=c.autoCheck),1==c.checked&&(a.options.checked=c.checked,a.options.checkState="checked"),angular.isDefined(c.checkState)&&(a.options.checkState=c.checkState,a.options.checked="checked"==a.options.checkState?!0:!1),angular.isDefined(c.controlStyle)&&a.updateControlStyle(c.controlStyle),0==c.enabled&&(a.options.enabled=c.enabled),1==c.rtl&&(a.options.rtl=c.rtl),angular.isDefined(c.text)&&(a.options.text=c.text),!0===c.threeState&&(a.options.threeState=c.threeState));a.updateLayout()}}}]);